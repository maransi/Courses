Curso ASP.NET Core 6 Fundamentals
---------------------------------

Observação: Todo parágrafo com o titulo "DEMO" diz respeito a parte prática do projeto, onde devemos
            desenvolver como uma espécie de exercício.

https://www.tutorialsteacher.com/mvc
https://asp.mvc-tutorial.com/pt/417/introduction/what-is-mvc/
https://www.learnrazorpages.com/
https://techfunda.com/howto/asp-net-mvc


Logotipo da loja precisa ser uma imagem PNG com Background Transparente, abaixo site que gera logos deste tipo
https://www.fococlipping.com
https://pt.pngtree.com/


Site de perguntas de entrevista
https://www.fullstack.cafe/


Instalações
===========

    . Instalação para as versões acima do Ubuntu 22.04

        wget https://dot.net/v1/dotnet-install.sh
        chmod +x dotnet-install.sh
        ./dotnet-install.sh -c 3.1
        ./dotnet-install.sh -c 5.0
        ./dotnet-install.sh -c 6.0
        ./dotnet-install.sh -c 7.0

        dotnet --version

        # insira as linhas abaixo no arquivo ".bashrc"
        export PATH="home/$USER/.dotnet:/home/$USER/.dotnet/tools:$PATH"
        export DOTNET_ROOT=/home/$USER/.dotnet/

        source ~/.bashrc

        sudo ln -s /home/$USER/.dotnet/dotnet /usr/bin/dotnet

        dotnet --version
        dotnet --list-runtimes
        dotnet --list-sdks

        cd /home/$USER/Download

        wget http://archive.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.0g-2ubuntu4_amd64.deb
        sudo dpkg -i libssl1.1_1.1.0g-2ubuntu4_amd64.deb


    Instalação das extensões do VSCode
    ----------------------------------

            C# 
            C# Extensions
            C# XML Documentation Comments
            ASP.NET Helper
            Razor Snippets
            Libman
            Docker
            vscode-icons (Opcional)
            NuGet Gallery
            VZ Dotnet File Template
            Dotnet Project References
            Auto-Using for C#
            Bracket Pair Colorization Toggler
            Error Lens
            RapidApi


        Testar
            Dotnet Solution Explorer
            Dotnet New Extension
            Net Core Extension Pack
            C# Utilities
            Nuget Package Manager
            Visual Nuget
            C# Developer Extension Package
            Auto closet tag
            C# Snippets

    Instalação do Nodejs
    --------------------

        sudo apt-get install nodejs
        sudo apt-get install npm

        ou

        sudo apt-get install curl python-software-properties
        curl -sL https://deb.nodesource.com/setup_12.x | sudo bash -
        sudo apt-get install -y nodejs
        
        node -v
        npm -v


Entendendo o ASP.NET Core 6 e ASP.NET Core 6 MVC
================================================

. Objetivos deste módulo:

    . Explicar o que é o ASP.NET Core?

    . O que será aprendido neste curso?

    . Quais ferramentas necessárias para o trabalho com o ASP.NET?

        . ASP.NET Core 6

        . Net 6

        . Visual Studio 2022

. O que é o ASP.NET Core?

    . É um framework open-source, criado pela Microsoft para a comunidade, para construir
        modernas aplicações web e serviços com .Net.

. O que podemos construir com ASP.NET Core?

    . Podemos desenvolver solução nas três camadas:

        . Server-side rendered applications

                            Http Request
              +--------------------------------------+
              |                                      |
              |                                      V
            Client                          Server ASP.NET Core
              ^                                      |
              |                                      |
              +--------------------------------------+
                    Dynmically generated HTML

        . Services

                                Http Request
                +-------------------------------------------------------+
                |                                                       |
                |                                                       V
            Consumer (Html, Angular, React, microservices, etc)     Server ASP.NET Core
                ^                                                       |
                |                                                       |
                +-------------------------------------------------------+
                                JSON

        . Client-side rendered applications

                    Initial Http Request via JQuery
              +--------------------------------------+
              |                                      |
              |                                      V
            Client                          Server ASP.NET Core
              ^                                      |  |
              |                                      |  |
              +--------------------------------------+  |
              ^     Application                         |
              |                                         |
              +-----------------------------------------+
                        JSON

. A principais caracteristicas do .NET Core é:

    . Ser "Cross-plataform framework", podendo ser usado
        no Windows, Linux e Mac, mantendo a compatibilidade em todas as plataformas.

    . Open Source

    . FAster development cycle - Continuas atualizações de versões do framework

    . Modular - Contém diversas bibliotecas que podem ser adicionadas ao projeto, 
                o repositório NUGET disponibiliza todas essas bibliotecas facilmente.

. Arquitetura do ASP.NET Core:

    +--------- ASP.NET Core Application Plataforms -------------+   +------- Other -----------------+
    |                                                           |   |                               |
    |   ASP.NET Core        ASP.NET Core        ASP.NET Core    |   |   Entity      ASP.NET Core    |
    |       MVC             Razor Pages             Blazor      |   |   Framework   Identity        |
    |                                                           |   |                               |
    +-----------------------------------------------------------+   +-------------------------------+

    +------------------------------------ ASP.NET Core Plataform -----------------------------------+
    |                                                                                               |
    |   Kestrel                         Middleware                                  Razor           |
    |                                                                                               |
    |   Model binding                   Dependency                                  Logging         |
    |                                   Injection                                                   |
    |                                                                                               |
    +-----------------------------------------------------------------------------------------------+

. ASP.NET Core Application Framework

            MVC                                         Razor Page                                    Blazor
            |                                               |                                           |
            V                                               V                                           V
    O ASP.NET Core MVC é uma                Recurso do ASP.NET Core MVC que torna a             O Blazor é uma estrutura/framework SPA 
    estrutura avançada para                 codificação de cenários focados em páginas          (Single Page Application) criada no .NET 
    a criação de aplicativos                mais fácil e mais produtiva. Responsável pela       que é executada no navegador com o WebAssembly
    Web e APIs usando o padrão              renderização das páginas Web Html
    de design Model-View-Controller

. Hisória do ASP.NET Core:

          2002                2016                  2019                    2021
    ASP.NET WebForms    ASP.NET Core 1.0    ASP.NET Core 3.0 e 3.1      ASP.NET Core 6
              \         /            \      /                    \        /  
                  2008              2017-2018                       2020
              ASP.NET MVC       ASP.NET Core2.0                 ASP.NET Core 5
                                ASP.NET Core 2.1 e 2.2

. LTS (Long-term supprt) e Versões Atuais

    . Com suporte até 3 anos após o lançamento da próxima versão.

. Cuurent release:

    . Suportado somnente 6 meses lançamento da próxima versão

. Tópicos abordados no curso:

    . ASP.NET Core

    . Applicaiton Framework

    . Entity Framework Core

    . Security

    . Testing

    . Deployment



Configurando uma aplicação ASP.NET Core 6 MVC
=============================================

Criando um novo projeto
-----------------------

    Dotnet Core
    -----------

        . Na pasta raiz de projeto execute o comando abaixo:

            dotnet new mvc SampleApplication -o sampleApplication -n sampleApplication -f net6.0

    Visual Studio Code
    ------------------

        . Na tela de "Get Started" escolha a opção "Create a New Project"

        . Na tela que se abre escolha a opção: "ASP.NET Core Web App (Model-View-Controller)" e acione "Next"

        . Na tela que se abre "Configure your new Project" informe:

            Project Name: "SampleApplication"
            Localition: "[pasta de projetos]/sampleApplication
            SolutionName: SampleApplication
            Place solution and project in the same directory: False

            Next

        . Na tela que abre "Additional information" informe:

            Framework: .Net 6.0
            Authentication Type: none
            Configure for HTTPS: True
            Enable Docker: False
            Do not use top level statements: False

            Next

    . Execute o projeto


Explorando os arquivos gerados
------------------------------

https://www.c-sharpcorner.com/article/folder-structure-of-asp-net-core-mvc-6-0-project/


    . Analisando a estrutura temos:

        wwwroot:            Diretório que contem arquivos estativos como imagens, javascripts, css, e outros;

        Areas:              Diretório que permite organizar nossa aplicação de forma que facilite a manutenção. 
                            No  nosso projeto por exemplo, teremos uma área especifica para o nosso painel de 
                            controle e ainda poderia ter uma área para acesso de cliente ou até com divisões 
                            relacionados a negócio.

        Controllers:        Como o próprio nome diz, é o diretório que contem os controllers utilizados no projeto;

        Models:             Diretório dos arquivos de models utilizados pelas Views e pelas Controllers;

        Views:              Diretorio que irá conter outros subdiretorios. Esses subdiretorios estarão 
                            relacionados diretamente com os controllers, ou seja, teremos as views de 
                            cada controller alem de views, partial views e layout utilizados;

        .csproj:            Contém os pacotes e referências do projeto.

        Program.cs:         Arquivo principal responsavel por inicializar a aplicação;

        Startup.cs:         Possui configurações de nosso projeto, tais como, definição de rotas, ativação de 
                            recursos relacionados ao ASP.NET Core ou ao projeto. A partir do .NET 6 em diante ele
                            não é mais criado no projeto.

        appsettings.json    Contém informações do projeto.
                            Podemos ter versões desse arquivo de acordo com o ambiente que o projeto atuará:

                            appsetings.json
                            appsettings.Development.json

                            O .Net tenta encontrar as informações inicialmente no "appsettings.Development.json", 
                            senão conseguir procura no "appsettings.json".

                            Local ideal para armazenar a string de conexão do bando de dados.

        Properties/launchSettings.json  Usado para armazenar configurações das informações do projeto, como porta, 
                                        ambiente, etc.
                                        Contém configurações necessárias para executar a aplicação



https://raphaelcardoso.com.br/criando-aplicacao-web-com-aspnet-core-mvc-parte-1/



. DEMO
    
    . Configurando a aplicação

        http://www.binaryintellect.net/articles/c131fc47-0c9d-496b-998a-ed65a2486896.aspx

        . Visual Studio

            . Create a New project

            . Escolha ASP.NET Core Empty

                Project Name: BhetanyPieShop
                Location: [Pasta do projeto]
                Solution Name: BhetanyPieShop
                Place Solution and Project in the same Directory: False

            . Additional Information

                Framework: .NET 6.0
                Configure for HTTPS: true
                Enable Docker: False
                Docker OS: Null
                Do not use top level statements: Null

            . Run

        . Dotnet core
            
            . Na pasta raiz do projeto execute o comando abaixo:

                dotnet new web -o bethanysPieShop -n bethanysPieShop -f net6.0

                dotnet clean

                dotnet restore

                dotnet build

                dotnet run



. No .Net 6 a execução começa pela classe "Program.cs"

    https://www.c-sharpcorner.com/article/how-to-add-startup-cs-class-in-asp-net-core-6-project/


        // Construi a aplicação
        var builder = WebAppication.CreateBuilder(args);
        var app = builder.Build();

        // Mapea a rota para ser chamada na linha debaixo
        app.MapGet("/", () => "Hello World!");

        // Executa a aplicação e fica escutando e respondendo alguma chamada na porta do projeto
        app.Run();  

    . No .Net 6 a classe "Startup.cs" foi suprimida

    . No .Net 6 a estrutura da classe "Program.cs" foi alterada deixando equivalente ao apresentado acima.

    . Mapeando uma Requisição

        . Na classe "Program.cs" temos a rota abaixo:

            app.MapGet("/", () => "Hello World!");
                            |
                            +----> Função anônima

        . A chamada acima resultará na URL:

            https://localhost:[porta]/



. Middlewares 

    . Desde a sua primeira versão, o ASP.NET faz uso dos middlewares. Eles foram implementados como uma 
        forma de modularizar uma aplicação ASP.NET facilmente.

    . Em termos práticos, middleware seria um trecho de código que pode ser executado no fluxo de execução 
        da aplicação. No ASP.NET os middleware são organizados em um pipeline e são executados conforme 
        uma solicitação é recebida e uma resposta enviada. A imagem abaixo ilustra este pipeline:


                    Middleware 1            Middleware 2            Middleware 3

        Request --> // Logic                
        
                        next() -----------> // Logic
                        
                                                next() -----------> // Logic

                                                                    // More logic
                                                                        |
                                            // More logic <-------------+
                                                    |
                    // More logic <-----------------+
                        |
        Response <------+

    . Cada middleware pode executar uma ação no recebimento da solicitação, chamar o próximo middleware, 
        utilizando o método next(), e executar outra ação durante o retorno da resposta. Só não é possível 
        modificar a resposta no seu retorno.

    . Dependendo da funcionalidade, o middleware pode decidir não chamar o próximo no pipeline, não invocando 
        o método next(). Por exemple, o middleware de arquivos estáticos pode retornar uma solicitação para um 
        arquivo estático e interromper o fluxo restante.

    . É possível definir middleware de diversas funcionalidades, por exemplo, no trecho de código abaixo, 
        temos oito middlewares:

        . Exception/error handling
        . HTTP Strict Transport Security Protocol
        . HTTPS redirection
        . Static file server
        . Cookie policy enforcement
        . Authentication
        . Session
        . MVC

    . Exemplo de um "Program.cs"

        public void Configure(IApplicationBuilder app)
        {
            if (env.IsDevelopment())
            {
                // Quando executado em desenvolvimento:
                //   Utiliza Developer Exception Page para reportar erros.
                //   Utiliza Database Error Page para reportar erros do banco.
                app.UseDeveloperExceptionPage();
                app.UseDatabaseErrorPage();
            }
            else
            {
                // Quando não estiver em produção:
                //   Habilita o middleware Exception Handler Middleware para pegar os erros.
                //   Utiliza o middleware que habilita o 
                //       HTTP Strict Transport Security Protocol (HSTS)
                app.UseExceptionHandler("/Error");
                app.UseHsts();
            }

            // Utiliza o middleware HTTPS Redirection que redireciona solicitações HTTP para HTTPS.
            app.UseHttpsRedirection();

            // Retorna arquivos estáticos e interrompe o pipeline.
            app.UseStaticFiles();

            // Utiliza o middleware Cookie Policy, que está em conformidade com 
            // as regras do GDPR (General Data Protection Regulation).
            app.UseCookiePolicy();

            // Autentica antes de utilizar os recursos.
            app.UseAuthentication();

            // Se o aplicativo utiliza sessão, chama o middleware Session depois do middleware 
            // Cookie Policy e antes do middleware MVC.
            app.UseSession();

            // Adiciona MVC ao pipeline da solicitação
            app.UseMvc();
        }


    https://www.treinaweb.com.br/blog/asp-net-core-compreendendo-addmvc-addmvccore-addcontrollers-addcontrollerswithviews-e-addrazorpages

    . "AddControllerWithViews()" carrega os recursos:

        . MvcCore;
        . ApiExplorer;
        . Authorization;
        . FormatterMappings;
        . Views;
        . RazorViewEngine;
        . TagHelper;
        . Data Annotations;
        . Json Formatters;
        . CORS.

        . O único que foi removido é o Razor Pages. Desta forma, uma aplicação ASP.NET MVC que não faça 
            uso do Razor Pages deve optar por este método.


    https://rodolfofadino.com.br/configurando-o-middleware-de-staticfiles-com-net-6-a6f61bdfdfc7

    . "UseStaticFiles()" para utilizarmos arquivos estáticos "css, jpeg, js" precisamos incluir este método 
        no "Program.cs". A partir dai podemos criar a pasta "wwwroot" na raiz do nosso projeto e adicionar
        qualquer arquivo estático nele e começar trabalhar com eles.

    . "app.Environment.IsDevelopment()" para entender melhor o funcionamento do método "IsDevelopment()" revise as
        aulas "Aula 71. Configurações de Debug" e "Aula 73.  Entendendo o LaunchSettings" do curso 
        "Fundamentos ASP.NET 6 - Balta"; que fala sobre o uso da variável ambiental "ASPNETCORE_ENVIRONMENT"

    . "MapDefaultControllerRoute()" 


    . Como é possível notar, no ASP.NET todos os middlewares são definidos no método Configure no padrão Use* 
        seguindo do nome do middleware. Neste método também é possível adicionar middlewares customizados, 
        utilizando os métodos Use ou Run. A diferença entres eles é que os middlewares definidos com Run 
        são middlewares “finais”, após eles, nenhum outro middleware é chamado.

    . Para compreender a ordem de execução dos middlewares no pipeline, vamos definir alguns middlewares simples:

        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            app.Use(async (context, next) =>
            {
                await context.Response.WriteAsync("Primeiro middleware (antes)");
                await next();
                await context.Response.WriteAsync("Primeiro middleware (depois)");
            });

            app.Use(async (context, next) =>
            {
                await context.Response.WriteAsync("Segundo middleware (antes)");
                await next();
                await context.Response.WriteAsync("Segundo middleware (depois)");
            });

            app.Run(async (context) =>
            {
                await context.Response.WriteAsync("Middleware final");
            });
        }

        . No exemplo acima os middlewares estão sendo definidos como métodos anônimos, em um artigo futuro mostrarei 
            as formas de declará-los.

        . Neste ponto o importante é que sabia que os middlewares definidos com Use recebem dois parâmetros: 
            a instância de um objeto HttpContext e a instância do delegate RequestDelegate, que aponta para o 
            próximo middleware no pipeline.

        . O resultado do código acima será algo assim:

            Primeiro middleware (antes)
            Segundo middleware (antes)
            Middleware final
            Segundo middleware (depois)
            Primeiro middleware (depois)

    . Criando novo fluxo final/Condicional

        . Com os métodos "Map" ou "MapWhen" é possível definir um novo fluxo final para o pipeline. O método Map permite 
            especificar um middleware que será invocado de acordo com o caminho da solicitação. Já o MapWhen possui 
            mais poder porque o padrão pode ser definido utilizando o objeto HttpContext:

        . Exemplo:

            public void Configure(IApplicationBuilder app, IHostingEnvironment env)
            {
                app.Use(async (context, next) =>
                {
                    await context.Response.WriteAsync("Primeiro middleware (antes)");
                    await next();
                    await context.Response.WriteAsync("Primeiro middleware (depois)");
                });

                app.Use(async (context, next) =>
                {
                    await context.Response.WriteAsync("Segundo middleware (antes)");
                    await next();
                    await context.Response.WriteAsync("Segundo middleware (depois)");
                });

                app.Map("/foo",
                    (a) => {
                        a.Use(async (context, next) => {
                            await context.Response.WriteAsync("Middleware para o caminho /foo (antes) ");
                            await next();
                            await context.Response.WriteAsync("Middleware para o caminho /foo (depois) ");
                        });
                });

                app.MapWhen(context => context.Request.Path.StartsWithSegments("/bar"), 
                    (a) => {
                        a.Use(async (context, next) => {
                            await context.Response.WriteAsync("Middleware para o caminho /bar (antes) ");
                            await next();
                            await context.Response.WriteAsync("Middleware para o caminho /bar (depois) ");
                        });
                });

                app.Run(async (context) =>
                {
                    await context.Response.WriteAsync("Middleware final");
                });
            }

        . Para evitar o problema do uso do next() nos middlewares definidos em Map e MapWhen, é possível 
            utilizar o método UseWhen, que funciona da mesma forma que o MapWhen, com a diferença que após 
            executá-lo o fluxo do pipeline retorna ao caminho padrão:

            public void Configure(IApplicationBuilder app, IHostingEnvironment env)
            {
                app.Use(async (context, next) =>
                {
                    await context.Response.WriteAsync("Primeiro middleware (antes)");
                    await next();
                    await context.Response.WriteAsync("Primeiro middleware (depois)");
                });

                app.Use(async (context, next) =>
                {
                    await context.Response.WriteAsync("Segundo middleware (antes)");
                    await next();
                    await context.Response.WriteAsync("Segundo middleware (depois)");
                });

                app.Map("/foo",
                    (a) => {
                        a.Use(async (context, next) => {
                            await context.Response.WriteAsync("Middleware para o caminho /foo (antes) ");
                            await next();
                            await context.Response.WriteAsync("Middleware para o caminho /foo (depois) ");
                        });
                });

                app.UseWhen(context => context.Request.Path.StartsWithSegments("/bar"), 
                    (a) => {
                        a.Use(async (context, next) => {
                            await context.Response.WriteAsync("Middleware para o caminho /bar (antes) ");
                            await next();
                            await context.Response.WriteAsync("Middleware para o caminho /bar (depois) ");
                        });
                });

                app.Run(async (context) =>
                {
                    await context.Response.WriteAsync("Middleware final");
                });
            }

    . Definindo uma classe “Middleware”

        . No dia a dia você irá definir middlewares mais complexos, então o ideal é defini-los em uma classe a parte:

            public class MyMiddleware
            {
                private readonly RequestDelegate _next;

                public MyMiddleware(RequestDelegate next)
                {
                    _next = next;
                }

                public async Task Invoke(HttpContext httpContext)
                {
                    await httpContext.Response.WriteAsync("Chamou nosso middleware (antes)");
                    await _next(httpContext);
                    await httpContext.Response.WriteAsync("Chamou nosso middleware (depois)");
                }
            }

        . A classe “Middleware” obrigatoriamente precisa ter a estrutura acima. Receber no construtor um 
            objeto RequestDelegate e definir um método Invoke que recebe por parâmetro um objeto HttpContext.

        . Esta classe pode ser definida no pipeline utilizando o método UseMiddleware:

            public void Configure(IApplicationBuilder app, IHostingEnvironment env)
            {
                app.UseMiddleware<MyMiddleware>();
            }


        . Mas o recomendado é definir um método de extensão para a interface IApplicationBuilder:

            public static class MyMiddlewareExtensions
            {
                public static IApplicationBuilder UseMyMiddleware(this IApplicationBuilder builder)
                {
                    return builder.UseMiddleware<MyMiddleware>();
                }
            }

        . E utilizá-lo no Configure:

            public void Configure(IApplicationBuilder app, IHostingEnvironment env)
            {
                app.UseMyMiddleware();
            
                app.Run(async (context) =>
                {
                    await context.Response.WriteAsync("Olá Mundo!");
                });
            }

        . Mais detalhes podem ser observados no link abaixo:

            https://www.treinaweb.com.br/blog/criando-um-middleware-customizado-para-asp-net-core
            https://exceptionnotfound.net/middleware-in-asp-dotnet-6-intro-and-basics/


. DEMO

    . Acesse a classe "Program.cs" do seu projeto e acrescente as linhas abaixo:

            var builder = WebAppication.CreateBuilder(args);

            builder.Services.AddControllersWithViews();              // Linha inserida

            var app = builder.Build();

            app.UseStaticFiles();                                   // Linha inserida

            if ( app.Environment.IsDevelopment() )                  // If inserido
            {
                app.UseDeveloperExceptionPage();                        
            }

            app.MapDefaultControllerRoute();                        // Linha inserida

            app.MapGet("/", () => "Hello World!");

            app.Run();  

    . Desenvolva o tutorial abaixo :

        https://macoratti.net/21/08/aspnc_authmid1.htm


Criando a primeira página
=========================


. O que aprenderemos nesse módulo:

    . Introdução ao padrão MVC

    . Criação de um model e um repository

    . Criação de um controller

    . Adicionar uma view

    . Estilizar a view

. Como funciona o MVC C#?

    . O MVC é um padrão de arquitetura de software. O MVC sugere uma maneira para você pensar na divisão de responsabilidades, 
        principalmente dentro de um software web.

    . O princípio básico do MVC é a divisão da aplicação em três camadas: a camada de interação do usuário (view), a camada de 
        manipulação dos dados (model) e a camada de controle (controller).

    . Com o MVC, é possível separar o código relativo à interface do usuário das regras de negócio, o que sem dúvida traz muitas 
        vantagens que veremos mais à frente.

    . Quando falamos sobre o MVC, cada uma das camadas apresenta geralmente as seguintes responsabilidades:

        . Model: A responsabilidade dos models é representar o negócio. Também é responsável pelo acesso e manipulação dos dados 
            na sua aplicação.

        . View: A view é responsável pela interface que será apresentada, mostrando as informações do model para o usuário.

        . Controller: É a camada de controle, responsável por ligar o model e a view, fazendo com que os models possam ser 
            repassados para as views e vice-versa.

    . MVC Pattern



                                 Request
                                    |
                                    | Levanta uma classe Controller "https://localhost:[porta]/clientes
                                    |
                                    V
                                controller  (Tem um metodo de ação publico)
                                ----------
                                  |     |  
                      +-----------+     +-----------------+
                      |                                   |  
                      |                                   |  
               Update |                                   | Dispara 
                      |                                   |  
                      |                                   |  
                      |                                   |  
                      V                                   V
                    View <----------------------------- Model
                    ----      Obtem dados do Model      -----
                      |       (EF, Dapper, ADO.NET)
                      |
                      |
                      | (Razor Page)
                      v
                    Response

. Criando o Model e o Repository

    . Ao criar um projeto MVC são criadas as pastas na estrutura do projeto:

        Controllers:        Como o próprio nome diz, é o diretório que contem os controllers utilizados no projeto;

        Models:             Diretório dos arquivos de models utilizados pelas Views e pelas Controllers;
                            Representa os objetos de domínio de dados e a lógica de acesso aos dados (DTOs, BOs, DAOs)

        Views:              Diretorio que irá conter outros subdiretorios. Esses subdiretorios estarão 
                            relacionados diretamente com os controllers, ou seja, teremos as views de 
                            cada controller alem de views, partial views e layout utilizados;

    . Haverá um conjunto padrão de classes para persistir as informações das requisições:

        . Model

        . Repository

    . Exemplo de uma classe Model

        public class Pie
        {
            public int PieId { get; set; }

            public string Name { get, set; }

            pulbic string? ShorDescription { get, set; }

            public bool IStock { get, set; }

            public Category Category { get, set; }
        }

    . Os repositorios permitem aos nosso codígos utilizem objetos sem saber com são persistidos. Criamos uma interface (contrato) 
        e e suas implementações com a persistência desses objetos.

        . Exemplo de uma interface para Repository:

            public interface IPieRepository
            {
                IEnumerable<Pie> AllPies { get; }

                Pie GetPieById( int pieId );
            }

        . Exemplo da implementação da classe Repository:

            public class MockPeiRepository: IPieRepository
            {
                public IEnumerable<Pie> AllPies
                {
                    get { ... }
                }

                public Pie GetPieById( in pieId )
                {
                    ...
                }
            }
    
    . Registrando o Repository

        Program.cs

            var builder = WebApplication.CreateBuilder( args );

            builder.Services.AddScoped<IPieRepository, MockPieRepository>();

            var app = builder.Build();
        
    . Service Locator

        . SL diz como resolver as depências criadas 

            . Funciona como um dê-para

        . Já temos um pronto no ASP.NET (build in the box)

            . Podemos utilizar outros 

                // Assim
                builder.Services.AddTransient<IPieRepository, MockPieRepository>();

                // ou
                builder.Services.AddScoped<IPieRepository, MockPieRepository>();

                // ou
                builder.Services.AddSingleton<IPieRepository, MockPieRepository>();

    . AddTransient, AddScoped, AddSingleton

        . AddTransient

            builder.Services.AddTransient<IPieRepository, MockPieRepository>();

                . Sempre cira uma nova instância do objeto

                . Ideal para cenários onde queremos sempre um novo objeto.

        . AddScoped

            builder.Services.AddScoped<IPieRepository, MockPieRepository>();

                . Cria um objeto por transação/requisição

                . Se você chamar 2 ou mais serviços que dendem do mesmo objeto, a mesma instância será utilizada

                . Ideal para cenários onde queremos apenas um objeto por requisição (banco).

        . AddSingleton

            . Cria um objeto quando a aplicação inicia e apaga da sessão quando a aplicação termina.

                builder.Services.AddSingleton<IPieRepository, MockPieRepository>();

            . Mantém este objeto na memória até a aplicação para ou reiniciar 

            . Sempre devolve a mesma instância deste objeto, com os mesmos valores.

            . Padrão que visa garantir apenas um instância de um objeto para aplicão toda

            . Um bom exemplo são as configurações

                . Uma vez carregadas, ficam até a aplicação reiniciar.

            . Cuidado.

        . Quadro comparativo

            Tipo	    Mesma requisição	Requisições diferentes
            ----        ----------------    ----------------------
            Singleton	Mesma instância	    Mesma instância
            Scoped	    Mesma instância	    Nova instância
            Transient	Nova instância	    Nova instância


        . AddDbContext

            . Item especial do tipo Scoped

                builder.Services.AddDbContext< BlogDataContext>( x => useSqlServer( connStr ));

            . Utilizado exclusivamente com o EF

            . Garante que a conexão só dura até o fim da requisição

    . DEMO

        . Crie na estrutura raiz do projeto a pasta "Models" e crie as classes abaixo:

            namespace bethanysPieShop.Models;

            public class Pie
            {
                public int PieId { get; set; }

                public string Name { get; set; } = string.Empty;

                public string? ShortDescription
                {
                    get; set;
                }

                public string? LongDescription
                {
                    get; set;
                }

                public string? AllergyInformation { get; set; }

                public decimal Price { get; set; }

                public string? ImageUrl { get; set; }

                public string? ImageThumbnailUrl { get; set; }

                public bool IsPieOfTheWeek { get; set; }

                public int CategoryId { get; set; }

                // public Category Category { get; set; }

                public bool InStock
                {
                    get; set;
                }

                public Category Category
                {
                    get; set;
                } = default!;
            }




            namespace bethanysPieShop.Models;

            public class Category
            {
                public int CategoryId { get; set; }

                public string CategoryName { get; set; } = string.Empty;

                public string? Description { get; set; }

                public List<Pie>? Pies { get; set; }
            }

        . Crie as classes e interfaces abaixo na mesma pasta "Models":

            namespace bethanysPieShop.Models;

            public interface IPieRepository
            {
                IEnumerable<Pie> AllPies { get; }

                IEnumerable<Pie> PiesOfTheWeek{ get; }

                Pie? GetPieById( int pieId );
            }




            namespace bethanysPieShop.Models;

            public interface ICategoryRepository
            {
                IEnumerable<Category> AllCategories{ get; }
            }

        . Crie a classe de implementação "MockCategoryRepository" dentro da pasta Models:

            namespace bethanysPieShop.Models;

            public class MockCategoryRepository : ICategoryRepository
            {
                public IEnumerable<Category> AllCategories => new List<Category>{
                                new Category{ CategoryId = 1, CategoryName = "Fruit pies", Description = "All fruity pies"},
                                new Category{ CategoryId = 2, CategoryName = "Cheese cakes", Description = "Cheesy all the way"},
                                new Category{ CategoryId = 3, CategoryName = "Seasonal pies", Description = "Get in the mood for a seasonal pie"}
                            };
            }



            namespace bethanysPieShop.Models;

            public class MockPieRepository : IPieRepository
            {

                private readonly ICategoryRepository _categoryRepository = new MockCategoryRepository();

                public IEnumerable<Pie> AllPies =>
                    new List<Pie>
                    {
                        new Pie {PieId = 1, Name="Strawberry Pie", Price=15.95M, ShortDescription="Lorem Ipsum", LongDescription="Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = _categoryRepository.AllCategories.ToList()[0],ImageUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/strawberrypie.jpg", InStock=true, IsPieOfTheWeek=false, ImageThumbnailUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/strawberrypiesmall.jpg"},
                        new Pie {PieId = 2, Name="Cheese cake", Price=18.95M, ShortDescription="Lorem Ipsum", LongDescription="Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = _categoryRepository.AllCategories.ToList()[1],ImageUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/cheesecake.jpg", InStock=true, IsPieOfTheWeek=false, ImageThumbnailUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/cheesecakesmall.jpg"},
                        new Pie {PieId = 3, Name="Rhubarb Pie", Price=15.95M, ShortDescription="Lorem Ipsum", LongDescription="Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = _categoryRepository.AllCategories.ToList()[0],ImageUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/rhubarbpie.jpg", InStock=true, IsPieOfTheWeek=true, ImageThumbnailUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/rhubarbpiesmall.jpg"},
                        new Pie {PieId = 4, Name="Pumpkin Pie", Price=12.95M, ShortDescription="Lorem Ipsum", LongDescription="Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = _categoryRepository.AllCategories.ToList()[2],ImageUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/seasonal/pumpkinpie.jpg", InStock=true, IsPieOfTheWeek=true, ImageThumbnailUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/seasonal/pumpkinpiesmall.jpg"}
                    };

                public IEnumerable<Pie> PiesOfTheWeek
                {
                    get
                    {
                        return AllPies.Where(p => p.IsPieOfTheWeek);
                    }
                }

                public Pie? GetPieById(int pieId) => AllPies.FirstOrDefault(p => p.PieId == pieId);

                public IEnumerable<Pie> SearchPies(string searchQuery)
                {
                    throw new NotImplementedException();
                }
            }


        . Acrescente as linhas abaixo na classe "Program.cs":

            using bethanysPieShop.Models;           // Linha inserida

            var builder = WebApplication.CreateBuilder(args);

            builder.Services.AddScoped<ICategoryRepository, MockCategoryRepository>();      // Linha inserida
            builder.Services.AddScoped<IPieRepository, MockPieRepository>();                // Linha inserida
            ...            


    . Criando o Controller

        . Um controlador determina qual resposta enviar de volta para um usuário quando um usuário faz uma solicitação de navegador. 
            Um controlador é apenas uma classe (por exemplo, uma classe Visual Basic ou C#). O exemplo ASP.NET aplicativo MVC inclui 
            um controlador chamado HomeController.cs localizado na pasta "Controllers".

        . Exemplo básico de um "Controller":


                                +----> Tem o padrão "Controller" no nome da classe
                                |
                            ----------
            public class PieController: Controller          // Normalmente armazenadas na pasta "Controllers"
            {                               |
                                            +---> Extende a class "Controller
                public ViewResult Index()
                {           |
                            +-------------> ViewResult é um subtipo de ActionResult, neste caso o único retorno possível seria uma "View()".
                                            Se fosse a classe genérica "ActionResult" o retorno poderia ser além de uma "ViewResult" também:

                                            PartialViewResult, ContentResult, etc.

                    return View();      // Executará o objeto "Index.cshtml" da pasta "Views/Pie"
                }
            }

        . "ActionResult" é uma classe abstrata, que é extendida pela classe "ViewResult", uma sub-classe:

                                    ActionResult
                                         ^
                                         v
                                         |      <<extend>>
                                         |
                                    ViewResult



                            ActionResult                    public ActionResult DynamicView(bool IsHtmlView)
                            ------------                    {
                                ^                               if (IsHtmlView)
                                |   <<deriva>>                      return View(); // returns simple ViewResult
                +---------------+---------------+                else
                |               |               |                   return Json(); // returns JsonResult view
            ViewResult      PartialView     Content          }
                              Result        Result


        . A classe "ActionResult" é uma classe abstrata que possui diversos sub tipos e temos uma classe apropriada para
            cada tipo de retorno que é derivada dessa classe. Abaixo vemos os principais tipos de retorno:
            
            Classe derivada         Descrição                                           Exemplo
            de ActionResult         ---------                                           -------
            ---------------

            ViewResult              Retorna uma View                                    return View();
                                                                                        return View("Nome da View", object-model);

            PartialViewResult       Retorna uma partial View, que pode ser inserida     return PartialView();
                                    em outra View. (UserControl)                        return PartialView("Nome da PartialView", objeto-model);

            RedirectResult          Redireciona para uma Url especifica                 return Redirect("http://www.site.com");

            RedirectToRoutResult    Redireciona para uma outra Action                   return RedirectToAcion"("Outra_Action", "Outro_Controller");
                                                                                        return RedirectTo-Route("Nome_da_rota");

            ContentResult           Retorno texto puro                                  return Context("Texto","textoPlano");

            JsonResult              Retorna um objecto no format JSON                   return Json(objeto);

            JavaScriptResult        Retorna código Javascript que pode ser executado    return Javascript("$('#divTxt').html('Javascript teste');");
                                    no cliente

            FileResult              Retorna dados binários (arquivo em disco, por ex)   return File(@"/dados/teste.pdf","applicationn/pdf");

            EmptyResult             Não retorn nada, igual a void                       return EmptyResult();

            HttpNotFoundResult      Retorna uma página não encontrada                   - x -

            HttpStatusCodeResult    HTTP definido pelo desenvolvedor                    Retorna um código de estado

            FileStreamResult        Envia um objeto Stream para o Navegador             - x -

            HttpUnauthorizedResult  Envia código de resposta HTTP 401 para o navegador  - x -

        . "PieController" reformulado:

            public class PieController: Controller
            {
                private readonly IPieRepository _pieRepository;

                public PieController( IPieRepository pieRepository )
                {
                    _pieRepository = pieRepository;
                }

                public ViewResult List()
                {
                    return View( _pieRepository.Pies );
                }
            }

    . DEMO

        . Crie a pasta "Controllers" e dentro dela a classe abaixo:

            using bethanysPieShop.Models;
            using Microsoft.AspNetCore.Mvc;

            namespace bethanysPieShop.Controllers;

            public class PieController : Controller
            {

                private readonly IPieRepository _pieRepository;
                private readonly ICategoryRepository _categoryRepository;

                public PieController(IPieRepository pieRepository,
                                        ICategoryRepository categoryRepository)
                {
                    _pieRepository = pieRepository;
                    _categoryRepository = categoryRepository;
                }


                public IActionResult List()
                {
                    return View(_pieRepository.AllPies);
                }
            }

    . Criando a View

        . O que é uma View:

            . Uma view é um template com a extensão *.cshtml que contém marcações HTML.

            . Usa Razor code, mix de C# com HTML.

            . Recebe um pouco de lógica ( condições, loop, tag helpers e view components ).
            
            . São HTML, CSS e Javascript.

            . Podem executar funções do C# com Razor (View Engine).

            . Podem interagir com objetos enviados a ela.

            . São processadas no servidor e enviadas para o cliente.

            . As Views podem receber parâmetros como variáveis ou tipos complexos.

            . Estes parâmetros são recebidos através da sintaxe @Model

            . Se um parâmetro diferente do esperado for enviado a view, causará um erro.

                . Este erro só ocorrerá em tempo de execução.

            . Além dados fisos, a view pode receber dados de outras formas.

        . Na estrutura do projeto, cada controller terá uma respectiva pasta dentro da pasta "Views", onde armazenamos os templates "*.cshtml". 

            Controllers/PieController   =>  Views/Pie
                        ---                       ---
                         |                         ^
                         |                         |
                         +-------------------------+

            . Por exemplo:

                public class PieController: Controller
                {

                    public ViewResult Index()   // Action
                    {
                        return View();          // View to show: Views/Pie/Index.cshtml
                    }
                }

            . O template "Views/Pie/Index.cshtml" poderia ser representado pelo código abaixo:

                <!DOCTYPE html>

                <html>
                    <head>
                        <title>Index</head>
                    </head>

                    <body>
                        <div>Welcome to Bethany´s Pie Shop<</div>
                    </body>
                </html>

            . Utilizando "ViewBag" do Controller

                public class PieController: Controller
                {

                    public ViewResult Index()   
                    {
                        ViewBag.Message = "Welcome to Bethany´s Pie Shop";          // Linha inserida       --------------------------------+
                                                                                                                                            |
                        return View();                                                                                                      |
                    }                                                                                                                       |
                }                                                                                                                           |
                                                                                                                                            |
                                                                                                                                            |
                . ViewBag é um objeto dinâmico que podemos colocar dados do controller                                                      |
                                                                                                                                            |
                . Dessa forma podemos fazer algumas mudança no nosso templace "cshtml" deixando-o mais dinâmico:                            |
                                                                                                                                            |
                    <!-- De -->                                                                                                             |
                    <body>                                                                                                                  |
                        <div>Welcome to Bethany´s Pie Shop<</div>                                                                           |
                    </body>                                                                                                                 |
                                                                                                                                            |
                                                                                                                                            |
                    <!-- Para -->                                                                                                           |
                    <body>                                                                                                                  |
                        <div>                                                                                                               |
                            @ViewBag.Message    <-------------------------------------------------------------------------------------------+
                        <</div>
                    </body>


                . Mesclando ViewBag com Razor

        . Razor Page

            . O Razor nada mais é do que a linguagem C#, ou VB.NET, trabalhando em conjunto com código HTML, para a construção das suas páginas ASP.NET.

            . Para fazer comentário numa página Razor utilize:

                @*
                    Comentário
                *@

            . Exemplo:

                @ViewBg.Message           ------------> Usando ViewBag in Razor

                <p>@DateTime.Now</p>      ------------> Apresentado a data no código Razor

                @{
                    var message = "Welcome to Bethany´s Pie Shp";   -----> Usando um bloco de códigos
                }

                <h3>@message</h3>

            . Chamando uma View fortemente tipada

                // PieController
                public class PieController: Controller
                {
                    public ViewResult List()
                    {
                        return View( _pieRepository.AllPies );
                    }
                }


                // Views/Pie/List.cshtml
                @model IEnumerable<Pie>

                <!DOCTYPE html>

                <html>
                    <body>
                        <div>
                        
                            @foreach( var pie in Model )
                            {
                                <div>
                                    <h2>@pie.Name </h2>
                                    <h3>@pie.Price.ToString("c") </h3>
                                    <h4>@pie.Category.CategoryName </h4>
                                </div>
                            }
                        </div>
                    </body>
                </html>

    . DEMO

        . Crie a pasta "Views/Pie" e dentro dela a view abaixo com a extensão "cshtml" com o nome "List.cshtml":

            @model IEnumerable<bethanysPieShop.Models.Pie>

            <!DOCTYPE html>

            <html>

            <head>
                <meta name="viewport" content="width=device-width" />
                <title>Bethany´s Pie Shop</title>
            </head>

            <body>
                <h1>@ViewBag.CurrentCategory</h1>


                @foreach( var pie in Model )
                {
                <div>
                    <h2>@pie.Name </h2>
                    <h3>@pie.Price.ToString("c") </h3>
                    <h4>@pie.Category.CategoryName </h4>
                </div>
                }

            </body>

            </html>

        . Acrescente as linhas abaixo na classe "PieController":

            using Microsoft.AspNetCore.Mvc;

            namespace bethanysPieShop.Controllers;

            public class PieController: Controller
            {

                ...

                public IActionResult List()
                {
                    ViewBag.CurrentCategory = "Cheese cakes";       // Linha inserida

                    return View( _pieRepository.AllPies );
                }
            }


        . Levante o projeto e execute a rota abaixo no navegador:

            https://localhost:[porta]/pie/list


        . Crie a pasta "ViewModels" e dentro dela a classe "PieListViewModel.cs" como abaixo:

            using bethanysPieShop.Models;

            namespace bethanysPieShop.ViewModels;

            public class PieListViewModel
            {
                public IEnumerable<Pie> Pies { get; }

                public string? CurrentCategory { get; }

                public PieListViewModel(IEnumerable<Pie> pies, string? currentCategory)
                {
                    Pies = pies;

                    CurrentCategory = currentCategory;
                }
            }

        . Altere o código do método "PieController.List" como abaixo:

            using betahnysPieShop.ViewModels;   // Linha inserida
            ...
            public IActionResult List()
            {
                // ViewBag.CurrentCategory = "Cheese cakes";       // Linha inserida

                // return View( _pieRepository.AllPies );

                PieListViewModel piesListViewModel = new PieListViewModel( _pieRepository.AllPies, "Cheese cakes");     // Linha inserida

                return View( piesListViewModel );           // Linha inserida
            }
            ...

        . Altere a view "Views/Pie/List.cshml" como abaixo:

            @model bethanysPieShop.ViewModels.PieListViewModel      <!-- Linha alterada -->

            <!DOCTYPE html>

            <html>

            <head>
                <meta name="viewport" content="width=device-width" />
                <title>Bethany´s Pie Shop</title>
            </head>

            <body>
                <h1>@Model.CurrentCategory</h1>         <!-- Linha alterada -->


                @foreach( var pie in Model.Pies )       <!-- Linha alterada -->
                {
                <div>
                    <h2>@pie.Name </h2>
                    <h3>@pie.Price.ToString("c") </h3>
                    <h4>@pie.Category.CategoryName </h4>
                </div>
                }

            </body>

            </html>

            @model bethanysPieShop.ViewModels.PieListViewModel             <!-- Linha alterada -->

            <!DOCTYPE html>

            <html>
            <head>
                <meta name="viewport" content="width=device-width" />
                <title>Bethany´s Pie Shop</head>
            </head>

            <body>
                <h1>@Model.CurrentCategory</h1>                             <!-- Linha alterada -->

                        
                @foreach( var pie in Model )
                {
                    <div>
                        <h2>@pie.Name </h2>
                        <h3>@pie.Price.ToString("c") </h3>
                        <h4>@pie.Category.CategoryName </h4>
                    </div>
                  }

            </body>
            </html>

        . Levante o projeto e execute a rota abaixo no navegador:

            https://localhost:[porta]/pie/list


    . Usando o _Layout.cshtml

        . Funciona como o slide mestre do power point

        . Você define um padrão que será utilizado por toda a aplicação.

        . Toda a página permance, mudando apensas o "miolo"

        . A regição que irá mudar é identificada pelo @Renderbody()

        . Podemos ter vários layouts

            . Um para login

            . Um para setor administrativo

            . Um para a loja.

        . Acessando a pasta "Views/Shared" encontramos o arquivo _Layout.cshtml.

        . Exemplo de _Layout.cshtml

            <!DOCTYPE html>

            <html>
                <head>
                    <title>Index</head>
                </head>

                <body>
                    <div>
                        @RenderBody()
                    </div>
                </body>
            </html>

        . O @RenderBody() é o responsável pela montagem da página.

        . Especificando um layout para a View:

            @{
                Layout = "_Layout";                                 <!-- Local para associar o arquivo _Layout.cshtml -->
            }

            @model bethanysPieShop.ViewModels.PieListViewModel             

            <!DOCTYPE html>

            <html>
            <head>
                <meta name="viewport" content="width=device-width" />
                <title>Bethany´s Pie Shop</head>
            </head>

            <body>
                <h1>@Model.CurrentCategory</h1>                             

                        
                @foreach( var pie in Model )
                {
                    <div>
                        <h2>@pie.Name </h2>
                        <h3>@pie.Price.ToString("c") </h3>
                        <h4>@pie.Category.CategoryName </h4>
                    </div>
                    }

            </body>
            </html>
            
    . DEMO

        . Atividades:

            . Adicionaremos um template layout

            . Criaremos o arquivo "ViewStart"

            . Adicionaremos o arquivo "ViewImports"

        . Crie a pasta "Shared" dentro da pasta Views 

        . Crie o arquivo "_Layout.cshtml" como abaixo na pasta "Views/Shared". 
            IMPORTANTE: No Visual Studio dê um clique direito sobre a pasta "Shared" / Add New Item / Installed / C# / ASP.NET Core / Web / Razor Layout

            <!DOCTYPE html>

            <html>
                <head>
                    <meta name="viewport" content="width=device-width" />
                    <title>@ViewBag.Title</title>
                </head>

                <body>
                    <div>
                        @RenderBody()           --------------------------------------------------------------------------------------------------------------------+
                    </div>                                                                                                                                          |
                </body>                                                                                                                                             |
            </html>                                                                                                                                                 |   Substituirá por esse
                                                                                                                                                                    |   código
        . Altere a view "Views/Pie/List.cshml" como abaixo, retirando todo código de responsabilidade do _Layout.cshtml deixando somente o miolo:                   |
                                                                                                                                                                    |
            @model bethanysPieShop.ViewModels.PieListViewModel              <---------------------------------------------------------------------------------------+

            @{
                Layout = "_Layout";
            }
            <h1>@Model.CurrentCategory</h1>                             

                    
            @foreach( var pie in Model.Pies )
            {
                <div>
                    <h2>@pie.Name </h2>
                    <h3>@pie.Price.ToString("c") </h3>
                    <h4>@pie.Category.CategoryName </h4>
                </div>
            }
            
        . Levante o projeto e execute a rota abaixo no navegador:

            https://localhost:[porta]/pie/list


        . Trabalhando com _ViewStart:

            . Retire o trecho de código abaixo da view "Views/Pie/List.cshml":

                @model bethanysPieShop.ViewModels.PieListViewModel    

                <!--                                                    |
                                                                        |
                @{                                                      |
                    Layout = "_Layout"                                  +-----------------------------------------------------------------------------------------------+
                }                                                       |                                                                                               |
                -->                                                     |                                                                                               |                                                                                           
                                                                                                                                                                        |
                <h1>@Model.CurrentCategory</h1>                                                                                                                         |
                                                                                                                                                                        |
                                                                                                                                                                        |
                @foreach( var pie in Model )                                                                                                                            |
                {                                                                                                                                                       |
                    <div>                                                                                                                                               |
                        <h2>@pie.Name </h2>                                                                                                                             |
                        <h3>@pie.Price.ToString("c") </h3>                                                                                                              |   Transportado 
                        <h4>@pie.Category.CategoryName </h4>                                                                                                            |   para o arquivo
                    </div>                                                                                                                                              |   "Views/_ViewStart.cshtml
                }                                                                                                                                                       |
                                                                                                                                                                        |
            . Crie o arquivo "_ViewStart.cshtml" como abaixo na pasta "Views".                                                                                          |
                IMPORTANTE: No Visual Studio dê um clique direito sobre a pasta "Views" / Add New Item / Installed / C# / ASP.NET Core / Web / Razor View Start         |   
                                                                                                                                                                        |
                                                                                                                                                                        |
                @{                                                                                                                                                      |
                    Layout = "_Layout";         <-----------------------------------------------------------------------------------------------------------------------+
                }

            . Levante o projeto e execute a rota abaixo no navegador:

                https://localhost:[porta]/pie/list

            . No navegador acesse o "Código fonte" da página e verifique o trecho HTML se está parecido com a do template "_Layout.cshtml"

        . Trabalhnado com "ViewImports":

            . Crie o arquivo "_ViewImports.cshtml" como abaixo na pasta "Views".                                                                 
                IMPORTANTE: No Visual Studio dê um clique direito sobre a pasta "Views" / Add New Item / Installed / C# / ASP.NET Core / Web / Razor View Imports


                @using bethanysPieShop.Models                   --------------------------------------------+
                @using bethanysPieShop.ViewModels                                                           |
                                                                                                            |   Retirada dos pacotes, colocando-os
            . Altere o arquivo "Views/Pie/List.cshtml" eliminando o nome do pacote do Model                 |   dentro do arquivo "_ViewImports.cshtml"
                                                                                                            |
                @model PieListViewModel                     // Linha alterada       <-----------------------+

                @{
                    Layout = "_Layout"
                }
                <h1>@Model.CurrentCategory</h1>                             

                        
                @foreach( var pie in Model )
                {
                    <div>
                        <h2>@pie.Name </h2>
                        <h3>@pie.Price.ToString("c") </h3>
                        <h4>@pie.Category.CategoryName </h4>
                    </div>
                }

    . Styling the View

        . ASP.NET é baseado em bootstrap

        . Site de templates para o Bootstrap https://bootswatch.com/help/

    . Instalando ferramenta Libman:

        https://marketplace.visualstudio.com/items?itemName=adrianwilczynski.libman
        https://khalidabuhakmeh.com/using-libman-to-manage-client-side-dependencies


        . Importante: Certifique-se que a variável ambiental DOTNET_ROOT está configurada corretamente apontando para a pasta de 
                        instalação do dotnet. Sem essa configuração o "libman" não irá executar.

        . Instale a ferramenta "Libman":

            dotnet tool install -g Microsoft.Web.LibraryManager.Cli

            libman --version

        . Instale o plugin "Libman Tools" no VSCode

        . Execute na pasta raiz os comandos abaixo:

            # Na pasta raiz do projeto
            libman init

            . Verifique o conteúdo do arquivo "libman.json"

        . Execute o comando abaixo na pasta raiz do projeto:

            libman install bootstrap@5.1.3

            . Verifique se foi criado a pasta "wwwroot/lib/bootstrap" com os arquivo da bibliote "bootstrap"

        . No comando de instalação acima não foi possível a execução, dando erro, embora toda a instalação tenha ocorrido com sucesso.
            Vamos substituir o "libman" pelo "npm" para fazer o downloading das bibliotecas javascript.

    . Instalando o npm

        . Verifique se o npm está instalado no ambiente, caso não esteja, proceda a instalação no inicio do documento:

            npm -v

    . DEMO

        . Execute os comandos abaixo na pasta raiz do projeto:

            npm install bootstrat@5.1.3

            npm install jquery@3.6.0

        . Crie a pasta "wwwroot/lib" dentro da raiz do projeto.

        . Copie as pastas bootstrap e jquery para dentro da pasta "wwwroot/lib"

        . Acesse o arquivo de material do curso "asp-dot-net-core-6-fundamentals" para pegar o conteúdo abaixo:

            . Atualize o conteúdo do arquivo "Shared/_Layout.cshtml" com o código abaixo:

                <!DOCTYPE html>

                <html>
                <head>
                    <meta name="viewport" content="width=device-width" />
                    <title>Bethany's Pie Shop</title>
                    <link href='https://fonts.googleapis.com/css?family=Work+Sans' rel='stylesheet' type='text/css'>
                    <script src="~/lib/jquery/dist/jquery.js"></script>
                    <script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
                    <link href="~/css/site.css" rel="stylesheet" />
                    <base href="/" />
                </head>
                <body>
                    <div class="container">
                        <header>
                            <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-primary"
                                aria-label="Bethany's Pie Shop navigation header">
                                <div class="container-xl">
                                    <a class="navbar-brand" asp-controller="Home" asp-action="Index">
                                        <img src="~/images/bethanys-pie-shop-logo_horiz-white.png" width="151" height="47" class="d-inline-block align-top mb-2 mt-1"
                                            alt="Bethany's Pie Shop Logo">
                                    </a>

                                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                                            aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                                        <span class="navbar-toggler-icon"></span>
                                    </button>

                                    <div class="collapse navbar-collapse" id="navbarCollapse">
                                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                        </ul>
                                    </div>
                                </div>
                            </nav>
                        </header>

                        @RenderBody()
                    </div>
                </body>
                </html>

            . Atualize o conteúdo do arquivo "Views/Pie/List.cshtml" com o conteúdo abaixo:

                @model PieListViewModel

                <h1>@Model.CurrentCategory</h1>

                <div class="row row-cols-1 row-cols-md-3 g-4">

                    @foreach (var pie in Model.Pies)
                    {
                        <div class="col">
                            <div class="card pie-card">
                                <img src="@pie.ImageThumbnailUrl" class="card-img-top" alt="@pie.Name">
                                <div class="card-body pie-button">
                                    <h4 class="d-grid">
                                    </h4>

                                    <div class="d-flex justify-content-between mt-2">
                                        <h2 class="text-start">
                                            <a class="pie-link">@pie.Name</a>
                                        </h2>
                                        <h5 class="text-nowrap">
                                            @pie.Price.ToString("c")
                                        </h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }

                </div>

            . Copie a pasta "wwwroot/images" do material do curso para a pasta do projeto "wwwroot/images"

            . Copie a pasta "wwwroot/css" do material do curso para a pasta do projeto "wwwroot/css"

        . Execute os comandos abaixo para levantar o projeto:

            dotnet clean

            dotnet build

            dotnet run

            . Levante o projeto e execute a rota abaixo no navegador:

                https://localhost:[porta]/pie/list

Working with Real Data Using Entity Framework Core 6
====================================================

    . DEMO

        . Objetivos deste módulo:

            . Adicionar os pacotes necessários para trabalhar com EF

            . Criação do DbContext

            . Alterando as configurações da aplicação

        . Na pasta raiz do projeto execute os comandos abaixo:

            dotnet add package Microsoft.EntityFrameworkCore --version 6.0.12

            dotnet add package Microsoft.EntityFrameworkCore.Tools --version 6.0.12

            dotnet add package Microsoft.EntityFrameworkCore.Sqlite --version 6.0.12

            # Se for usar o banco de dados SQL Server execute a linha abaixo
            #
            # dotnet add package Microsoft.EntityFrameworkCore.SqlServer --version 6.0.12

            dotnet add package Microsoft.EntityFrameworkCore.Design --version 6.0.12


            # Execute a linha abaixo caso o "dotnet-ef" não existir no ambiente
            dotnet tool install --global dotnet-ef --version 6.0.12

        . Instale o "DB Browser for SQLite" para realizar as consultas no banco de dados

        . Acesse os arquivos "appsettings.json" e "appsettings.Development.json" e insira a linha abaixo:

            {
                "ConnectionStrings": {              
                    "DefaultConnection": "DataSource=app.db;Cache=Shared"
                },
                ...
            }

            . IMPORTANTE: As configurações de "Development" existentes nos "Properties/launchSetting.json" não está apontando
                            para o arquivo "appsetings.Development.json", talvez isto ocorra devido ao comando "dotnet ef migrations..."
                            enxergar somente o arquivo "appsetings.json"


        . Crie a pasta "Data" dentro da raiz do projeto e dentro dela crie a classe abaixo:

            using bethanysPieShop.Models;
            using Microsoft.EntityFrameworkCore;

            namespace bethanysPieShop.Data
            {
                public class AppDbContext : DbContext
                {
                    public DbSet<Category>? Categories { get; set; }
                    public DbSet<Pie>? Pies { get; set; }

                    public AppDbContext(DbContextOptions<AppDbContext> options) : base(options)
                    {
                    }

                    //            protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder) 
                    //                        => optionsBuilder.UseSqlite();
                    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
                    {
                        optionsBuilder.UseSqlite();
                        optionsBuilder.LogTo(Console.WriteLine);
                    }


                }
            }


        . Adicione as linhas abaixo na classe "Program.cs":

            ...
            var builder = WebApplication.CreateBuilder(args);

            builder.Services.AddScoped<ICategoryRepository, MockCategoryRepository>();      
            builder.Services.AddScoped<IPieRepository, MockPieRepository>();                

            builder.Services.AddDbContext<AppDbContext>( options => {                           // Linha inserida
                options.UseSqlite( 
                    builder.Configuration["ConnectionStrings:DefaultConnection"]);
            });

        . Crie as classes repository abaixo dentro da pasta "Models":

            using Microsoft.EntityFrameworkCore;

            namespace bethanysPieShop.Models
            {
                public class PieRepository : IPieRepository
                {
                    private readonly Context _context;

                    public PieRepository(Context Context)
                    {
                        _context = Context;
                    }

                    public IEnumerable<Pie> AllPies
                    {
                        get
                        {
                            return _context.Pies.Include(c => c.Category);
                        }
                    }

                    public IEnumerable<Pie> PiesOfTheWeek
                    {
                        get
                        {
                            return _context.Pies.Include(c => c.Category).Where(p => p.IsPieOfTheWeek);
                        }
                    }

                    public Pie? GetPieById(int pieId)
                    {
                        return _context.Pies.FirstOrDefault(p => p.PieId == pieId);
                    }

                    public IEnumerable<Pie> SearchPies(string searchQuery)
                    {
                        throw new NotImplementedException();
                    }
                }
            }


            using bethanysPieShop.Data;

            namespace bethanysPieShop.Models
            {
                public class CategoryRepository : ICategoryRepository
                 {
                    private readonly AppDbContext _context;

                    public CategoryRepository(AppDbContext Context)
                    {
                        _context = Context;
                    }

                    public IEnumerable<Category> AllCategories => _context.Categories.OrderBy(p => p.CategoryName);
                }
            }

        . Altere a classe "Model" "Pie.cs" como abaixo:

            using System.ComponentModel.DataAnnotations;
            using System.ComponentModel.DataAnnotations.Schema;
            using Microsoft.EntityFrameworkCore;

            namespace bethanysPieShop.Models;

            [Table("Pie")]
            public class Pie
            {
                [Key]
                [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
                [Column("PieId")]
                public int PieId { get; set; }

                [Required(ErrorMessage = "Este campo é obrigatorio")]
                [MaxLength(150, ErrorMessage = "Este campo deve ter entre 5 a 100 caracateres")]
                [MinLength(5, ErrorMessage = "Este campo dever ter entre 5 a 100 caracateres")]
                [Column("Name", TypeName = "VARCHAR(100)")]
                public string Name { get; set; } = string.Empty;


                [MaxLength(50, ErrorMessage = "Este campo deve ter entre 5 a 50 caracateres")]
                [MinLength(5, ErrorMessage = "Este campo dever ter entre 5 a 50 caracateres")]
                [Column("ShortDescription", TypeName = "VARCHAR(50)")]
                public string? ShortDescription
                {
                    get; set;
                }

                [MaxLength(100, ErrorMessage = "Este campo deve ter entre 5 a 100 caracateres")]
                [MinLength(5, ErrorMessage = "Este campo dever ter entre 5 a 100 caracateres")]
                [Column("LongDescription", TypeName = "VARCHAR(100)")]
                public string? LongDescription
                {
                    get; set;
                }

                [MaxLength(150, ErrorMessage = "Este campo deve ter entre 5 a 150 caracateres")]
                [MinLength(5, ErrorMessage = "Este campo dever ter entre 5 a 150 caracateres")]
                [Column("AllergyInformation", TypeName = "VARCHAR(150)")]
                public string? AllergyInformation { get; set; }

                [Precision(15, 2)]
                [Column("Price", TypeName = "DECIMAL(15,2)")]
                public decimal Price { get; set; }


                [Column("ImageUrl", TypeName = "VARCHAR(255)")]
                public string? ImageUrl { get; set; }


                [Column("ImageThumbnailUrl", TypeName = "VARCHAR(255)")]
                public string? ImageThumbnailUrl { get; set; }

                public bool IsPieOfTheWeek { get; set; }


                [Column("CategoryId", TypeName = "INTEGER")]
                public int CategoryId { get; set; }


                public bool InStock
                {
                    get; set;
                }

                [ForeignKey("CategoryId")]
                public Category Category
                {
                    get; set;
                } = default!;
            }

        . Altere a classe "Model" "Category.cs" como abaixo:
        
            using System.ComponentModel.DataAnnotations;
            using System.ComponentModel.DataAnnotations.Schema;
            using bethanysPieShop.Models;

            namespace bethanysPieShop.Models;

            [Table("Category")]
            public class Category
            {

                [Key]
                [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
                [Column("CategoryId")]
                public int CategoryId { get; set; }

                [Required(ErrorMessage = "Este campo é obrigatorio")]
                [MaxLength(100, ErrorMessage = "Este campo deve ter entre 5 a 100 caracateres")]
                [MinLength(5, ErrorMessage = "Este campo dever ter entre 5 a 100 caracateres")]
                [Column("Name", TypeName ="VARCHAR(100)")]
                public string CategoryName { get; set; } = string.Empty;

                [Required(ErrorMessage = "Este campo é obrigatorio")]
                [MaxLength(150, ErrorMessage = "Este campo deve ter entre 5 a 150 caracateres")]
                [MinLength(5, ErrorMessage = "Este campo dever ter entre 5 a 150 caracateres")]
                [Column("Description", TypeName ="VARCHAR(100)")]
                public string? Description { get; set; }

                public List<Pie>? Pies { get; set; }
            }

        . Acesse a classe "Program.cs" e faça as alterações abaixo:

            using bethanysPieShop.Models;           

            var builder = WebApplication.CreateBuilder(args);

                                                                +---> de MockCategoryRepository -> para CategoryRepository
                                                                |
            builder.Services.AddScoped<ICategoryRepository, CategoryRepository>();      // Linha alterada
            builder.Services.AddScoped<IPieRepository, PieRepository>();                // Linha alterada
            ...

        . Na raiz do projeto execute os comandos abaixo:

            dotnet clean

            dotnet build

            dotnet ef migrations add InitialCreation

            dotnet ef database update

        . Crie a classe abaixo na pasta "Models":

            using bethanysPieShop.Data;
            using bethanysPieShop.Models;

            namespace bethanysPieShop.Models
            {
                public static class DbInitializer
                {
                    public static void Seed(IApplicationBuilder applicationBuilder)
                    {
                        AppDbContext context = applicationBuilder.ApplicationServices.CreateScope().ServiceProvider.GetRequiredService<AppDbContext>();

                        if (!context.Categories.Any())
                        {
                            context.Categories.AddRange(Categories.Select(c => c.Value));
                        }

                        if (!context.Pies.Any())
                        {
                            context.AddRange
                            (
                                new Pie { Name = "Caramel Popcorn Cheese Cake", Price = 22.95M, ShortDescription = "The ultimate cheese cake", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Cheese cakes"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/caramelpopcorncheesecake.jpg", InStock = true, IsPieOfTheWeek = true, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/caramelpopcorncheesecakesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Chocolate Cheese Cake", Price = 19.95M, ShortDescription = "The chocolate lover's dream", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Cheese cakes"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/chocolatecheesecake.jpg", InStock = true, IsPieOfTheWeek = true, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/chocolatecheesecakesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Pistache Cheese Cake", Price = 21.95M, ShortDescription = "We're going nuts over this one", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Cheese cakes"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/pistachecheesecake.jpg", InStock = true, IsPieOfTheWeek = true, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/pistachecheesecakesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Pecan Pie", Price = 21.95M, ShortDescription = "More pecan than you can handle!", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Fruit pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/pecanpie.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/pecanpiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Birthday Pie", Price = 29.95M, ShortDescription = "A Happy Birthday with this pie!", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Seasonal pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/seasonal/birthdaypie.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/seasonal/birthdaypiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Apple Pie", Price = 12.95M, ShortDescription = "Our famous apple pies!", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Fruit pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/applepie.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/applepiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Blueberry Cheese Cake", Price = 18.95M, ShortDescription = "You'll love it!", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Cheese cakes"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/blueberrycheesecake.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/blueberrycheesecakesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Cheese Cake", Price = 18.95M, ShortDescription = "Plain cheese cake. Plain pleasure.", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Cheese cakes"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/cheesecake.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/cheesecakesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Cherry Pie", Price = 15.95M, ShortDescription = "A summer classic!", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Fruit pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/cherrypie.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/cherrypiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Christmas Apple Pie", Price = 13.95M, ShortDescription = "Happy holidays with this pie!", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Seasonal pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/christmasapplepie.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/christmasapplepiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Cranberry Pie", Price = 17.95M, ShortDescription = "A Christmas favorite", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Seasonal pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/cranberrypie.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/cranberrypiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Peach Pie", Price = 15.95M, ShortDescription = "Sweet as peach", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Fruit pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/peachpie.jpg", InStock = false, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/peachpiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Pumpkin Pie", Price = 12.95M, ShortDescription = "Our Halloween favorite", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Seasonal pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/pumpkinpie.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/pumpkinpiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Rhubarb Pie", Price = 15.95M, ShortDescription = "My God, so sweet!", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Fruit pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/rhubarbpie.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/rhubarbpiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Strawberry Pie", Price = 15.95M, ShortDescription = "Our delicious strawberry pie!", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Fruit pies"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/strawberrypie.jpg", InStock = true, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/strawberrypiesmall.jpg", AllergyInformation = "" },
                                new Pie { Name = "Strawberry Cheese Cake", Price = 18.95M, ShortDescription = "You'll love it!", LongDescription = "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = Categories["Cheese cakes"], ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/strawberrycheesecake.jpg", InStock = false, IsPieOfTheWeek = false, ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/strawberrycheesecakesmall.jpg", AllergyInformation = "" }
                            );
                        }

                        context.SaveChanges();
                    }

                    private static Dictionary<string, Category>? categories;

                    public static Dictionary<string, Category> Categories
                    {
                        get
                        {
                            if (categories == null)
                            {
                                var genresList = new Category[]
                                {
                                                new Category { CategoryName = "Fruit pies" },
                                                new Category { CategoryName = "Cheese cakes" },
                                                new Category { CategoryName = "Seasonal pies" }
                                };

                                categories = new Dictionary<string, Category>();

                                foreach (Category genre in genresList)
                                {
                                    categories.Add(genre.CategoryName, genre);
                                }
                            }

                            return categories;
                        }
                    }
                }
            }

        . Insira a linha abaixo dentro da classe "Programs.cs":

            ...
            app.MapDefaultControllerRoute();

            app.MapGet("/", () => "Hello World!");

            DbInitializer.Seed( app );        // Linha inserida

            app.Run();



        . Levante o projeto e execute a rota abaixo no navegador:

            https://localhost:[porta]/pie/list


Adding Routes and Navigation
============================

    . Roteamento em ASP.NET Core e ASP.NET Core MVC

        . A responsabilidade pela resposta das requisições ao encargo dos controller, onde contém as rotas que são acionandas pelos usuários através
            dos Browser.

        . Endpoints:

            . São unidades executáveis que trata uma requisição e geram uma resposta.

            . Podem ser definidas:

                . Minimal API, diretamente de dentro do "Program.cs":

                    ...
                    app.UseSwagger();// Ativando o Swagger

                    // Endpoints da solução
                    app.MapGet("/", () => "Hello World!");
                    ...

                . Controllers:

                    ... 
                    [Route("minharota")]
                    public string MinhaAction()
                    {
                        return "Ok! Cheguei na rota";
                    }
                    ...

        . Os "middlewares" que disponibilizam os recursos de endpoints para a aplicação inicialmente são:

            UseRounting()

                Its purpose is to:

                . Parse the incoming URL
                . Resolve the URL and construct the Endpoint.
                . Updates the HTTP Context object with the endpoint using the SetEndpoint method.

            UseEndpoints()

                The EndpointMiddleware is responsible for execution the Endpoint

            ╔══════════════════════════════════════════╦═══════════════════════════════════════╗
            ║             app.UseRouting()             ║          app.UseEndPoints()           ║
            ╠══════════════════════════════════════════╬═══════════════════════════════════════╣
            ║               Find Endpoint              ║           Execute Endpoint            ║
            ║                                          ║                                       ║
            ║  Adds route matching to the middleware   ║  Adds endpoint execution to the       ║
            ║  pipeline. This middleware looks at the  ║  middleware pipeline.                 ║
            ║  set of endpoints defined in the app,    ║  It runs the delegate associated      ║
            ║  and selects the best match based        ║  with the selected endpoint.          ║
            ║  on the request.                         ║                                       ║
            ║                                          ║                                       ║
            ╚══════════════════════════════════════════╩═══════════════════════════════════════╝            

https://www.tektutorialshub.com/asp-net-core/asp-net-core-endpoint-routing/ 

            . Program.cs

                app.UseRouting();
            
                app.UseAuthorization();
            
                app.UseEndpoints(endpoints =>
                {
                    endpoints.MapControllerRoute(
                        name: "default",
                        pattern: "{controller=Home}/{action=Index}/{id?}");
                });

        . Tipos de rotas:

            https://www.dotnettricks.com/learn/aspnetcore/routing 

            . Roteamento convencional:

                Configuramos uma ou mais convenções que serão usadas para corresponder URLs de 
                entrada a pontos de extremidade no aplicativo. No ASP.NET Core, esses pontos 
                de extremidade podem ser ações do controlador, como em ASP.NET MVC ou API Web.            
                                                                        |               |
                Program.cs                                              |               |
                ----------                                              |               |
                                                                        |               |
                    app.UseRouting();                                   |               |
                                                                        |               |
                    app.UseAuthorization();                             |               |
                                                                        |               |
                    app.UseEndpoints(endpoints =>               <-------+               |
                    {                                                                   |
                        endpoints.MapControllerRoute(                                   |
                            name: "default",                                            |
                            pattern: "{controller=Home}/{action=Index}/{id?}");         |
                    });                                                                 |
                                                                                        |
                                                                                        |
                PieController                                                           |
                ------------                                                            |
                                                                                        |
                    public class PieController: Controller                              |
                    {                                                                   V
                        public ViewResult List()    // http://www.bethanypieshop.com/Pie/List
                        {                                                             |   |
                            //                                                        V   +--> Action
                        }                                                         Controller
                    }


            . Roteamento de atributo:

                O roteamento de atributo no ASP.NET Core é a abordagem preferencial para 
                configurar o roteamento em controladores. Se você estiver criando APIs, 
                o atributo [ApiController] deverá ser aplicado aos controladores. Entre 
                outras coisas, esse atributo requer o uso do roteamento de atributo para 
                ações nessas classes de controlador                     |       |
                                                                        |       |
                    [HttpGet("api/products/{id}")]              <-------+       |
                    public async ActionResult<Product> Details(int id)          |
                    {                                                           |
                        // ...                                                  |
                    }                                                           |
                                                                                |
                                                                                |
                    [Route("api/{controller}/{action}/{id?:int}")]      <-------+
                    public abstract class BaseApiController : ControllerBase, IApiController
                    {
                        // ...
                    }

    . DEMO

        . Observe a linha abaixo na classe "Program.cs" que contém o Middleware "MapDefaultControllerRoute()".
                                                                                            |
            ...                                                                             |
            app.MapDefaultControllerRoute();        <---------------------------------------+

            app.MapGet("/", () => "Hello World!");

            DbInitializer.Seed( app );       

            app.Run();

        . Ao usarmos "app.MapDefaultControllerRoute()" como acima ao invés do "app.UseEndPoints":

                app.UseEndpoints(endpoints =>                     
                {                                                          
                    endpoints.MapControllerRoute(                          
                        name: "default",                                   
                        pattern: "{controller=Home}/{action=Index}/{id?}");
                });                                                        

                O "app.MapDefaultControllerRoute()" já assumirá o padrão de rota "{controller=Home}/{action=Index}/{id?}" sem grandes detalhes.
                                                                                    |                   |            |   
                                                                                    +--> Controller     +---> Action +---> parameter

                para enquadrar as requisições e encontrar a classe controller e seu método, exemplo:

                    http://localhost/           ->      HomeController.Index()  
                    http://localhost/Home/Index     ->      HomeController.Index()  
                    http://localhost/Home/Something ->      HomeController.Something()
                    http://localhost/Test/      ->      HomeController.Test()  
                    http://localhost/Test/1      ->      HomeController.Test(int id)  


                . IMPORTANTE: No final tanto o "app.MapDefaultControllerRoute();" quanto o "app.UseEndpoints(endpoints => ... )" da forma como estão acima terão comportamentos
                    iguais, enquadrão as requisições no padrão de rota "{controller=Home}/{action=Index}/{id?}". No exemplo abaixo faremos uso da maneira mais simples
                    "app.MapDefaultControllerRoute()".

        . Crie o método abaixo na classe "PieController.cs":

            ...
            public class PieController: Controller
            {
                ...

                public IActionResult Details( int id )              // Método inserido
                {
                    var pie = _pieRepository.GetPieById( id );

                    if (pie == null)
                        return NotFound();

                    return View( pie );
                }
            }

        . Crie a View "~/View/Pie/Details.cshtml" com o conteúdo abaixo:

            @model Pie

            <h3 class="my-5">
                @Model.Name
            </h3>

            <div class="row gx-5">
                <img alt="@Model.Name" src="@Model.ImageUrl" class="img-fluid col-5" />
                <div class="col-7">
                    <h4>@Model.ShortDescription</h4>
                    <p>@Model.LongDescription</p>
                    <h3 class="pull-right">@Model.Price.ToString("c")</h3>
                    <div class="addToCart">
                        <p class="button">
                        
                        </p>
                    </div>
                </div>
            </div>

        . Levante o projeto e execute a rota abaixo:

            https://localhost:[porta]/pie/details/7

    . Configurando Rotas

        https://www.tutorialsteacher.com/mvc/html-helpers
                            |
                            v
                Pesquisar sobre "HTML Helper" concorrente do "Tag Helper"



        . Criando um link com "Tag Helpers":

            . Para inserir uma tag de link no nosso HTML gerado pelo ASP.NET Core utilize a tag abaixo:

                <!-- Razor HTML -->
                <a asp-controller="Pie" asp-action="List">
                    View Pie List
                </a>

                <!-- HTML gerado -->
                <a href="/Pie/List">View Pie List</a>

            . Podemos utilizar no lugar das "Tag Helper", os "Html Helper", por exemplo:

                <!--
                @Html.ActionLink($"{pie.Name}", 
                                    "Details", 
                                    new{ id = pie.PieId },
                                    new { @class = "pie-link" }) 
                                    
                    https://localhost:[porta]/Pie/[codigo]

                @Html.ActionLink(
                            linkText: $"{pie.Name}",
                            actionName: "Details",
                            controllerName: "Pie",
                            routeValues: new { id = pie.PieId },
                            htmlAttributes: new { target = "_blank",@class="btn" , @style="background-color:lightblue;margin: 10px 30px;"})

                    https://localhost:[porta]/Pie/[codigo]
                -->



            . Para fazer uso das "Tags Helpers" precisamos importá-las no arquivo "_ViewImports.cshtml":

                @using bethanysPieShop.Models    
                @using bethanysPieShop.ViewModels            

                @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers            // Linha inserida

            . Atributos de Tag Helper disponíveis:

                https://www.learnrazorpages.com/razor-pages/tag-helpers/
                https://www.dotnettricks.com/learn/aspnetcore/aspnet-core-tag-helpers
                https://endjin.com/blog/2022/02/tag-helpers-in-aspnet-core
                https://endjin.com/blog/2022/01/model-binding-in-asp-net-core-using-razor-pages

                asp-controller      tag helper can be used to indicate which controller should be targeted by the 
                                    post action of a form.
                asp-route-{value}   tag helper (where {value} can be replaced with the name of the parameter we want to 
                                    specify the value for) allows us to create a route.
                asp-route           tag helper allows us to indicate which main route we want to use.
                asp-forgery         tag helper allows us to prevent cross-site request forgery attacks on the 
                                    site when used with the [ValidateAntiForgeryToken] attribute in the HTTP 
                                    Post action method.
                asp-action          To specify the controller action we want to target using tag helpers

    . DEMO

        . Insira a linha abaixo no arquivo "_ViewImports.cshtml":

            @using bethanysPieShop.Models    
            @using bethanysPieShop.ViewModels            

            @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers            // Linha inserida

        . Altere as linhas abaixo no arquivo "Views/Pie/List.cshtml":

            @model PieListViewModel

            <h1>@Model.CurrentCategory</h1>

            <div class="row row-cols-1 row-cols-md-3 g-4">

                @foreach (var pie in Model.Pies)
                {
                    <div class="col">
                        <div class="card pie-card">
                            <img src="@pie.ImageThumbnailUrl" class="card-img-top" alt="@pie.Name">
                            <div class="card-body pie-button">
                                <h4 class="d-grid">
                                </h4>

                                <div class="d-flex justify-content-between mt-2">
                                    <h2 class="text-start">

                                    <!-- Div "a" alterada -->

                                        <a asp-controller="Pie"
                                        asp-action="Details"
                                        asp-route-id="@pie.PieId"
                                        class="pie-link">@pie.Name</a>

                                    <!-- -->

                                    </h2>
                                    <h5 class="text-nowrap">
                                        @pie.Price.ToString("c")
                                    </h5>
                                </div>
                            </div>
                        </div>
                    </div>
                }

            </div>

        . Levante o projeto e verifique se os links de "details" na tela de "List" estão funcionando:

        . Crie o "ViewModel" abaixo:

            using bethanysPieShop.Models;

            namespace bethanysPieShop.ViewModels
            {
                public class HomeViewModel
                {
                    public IEnumerable<Pie> PiesOfTheWeek { get; }

                    public HomeViewModel(IEnumerable<Pie> piesOfTheWeek)
                    {
                        PiesOfTheWeek = piesOfTheWeek;
                    }
                }
            }

        . Acesse o arquivo "Program.cs" e comente a linha abaixo:

            ...

            // app.MapGet("/", () => "Hello World!");

            ...

        . Crie o controller abaixo:

            using bethanysPieShop.Models;
            using bethanysPieShop.ViewModels;
            using Microsoft.AspNetCore.Mvc;

            namespace bethanysPieShop.Controller
            {
                public class HomeController : Controller
                {
                    private readonly IPieRepository _pieRepository;

                    public HomeController(IPieRepository pieRepository)
                    {
                        _pieRepository = pieRepository;
                    }

                    public ViewResult Index()
                    {
                        var piesOfTheWeek = _pieRepository.PiesOfTheWeek;

                        var homeViewModel = new HomeViewModel(piesOfTheWeek);

                        return View(homeViewModel);
                    }
                }
            }

        . Crie na pasta "Views/Home" o arquivo "Index.cshtml":

            @model HomeViewModel


            <div id="carouselImages" class="carousel slide" data-bs-ride="true">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselImages" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselImages" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselImages" data-bs-slide-to="2" aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="~/images/carousel1.jpg" class="d-block w-100" alt="Carousel image 1">
                    </div>
                    <div class="carousel-item">
                        <img src="~/images/carousel2.jpg" class="d-block w-100" alt="Carousel image 2">
                    </div>
                    <div class="carousel-item">
                        <img src="~/images/carousel3.jpg" class="d-block w-100" alt="Carousel image 3">
                    </div>
                </div>
            </div>

            <div class="text-center">
                <img src="images/bethanys-pie-shop-logomark.png" class="logo-mark mx-auto" />
                <h1>Pies of the week</h1>
                <h5>Enjoy a weekly selection of our favorite pies</h5>

                <div class="row pies-of-the-week">
                    <div class="row row-cols-1 row-cols-md-3 g-4">
                        @foreach (var pie in Model.PiesOfTheWeek)
                        {
                            <div class="col">
                        <div class="card pie-card">
                            <img src="@pie.ImageThumbnailUrl" class="card-img-top" alt="@pie.Name">
                            <div class="card-body pie-button">
                                <h4 class="d-grid">
                                </h4>

                                <div class="d-flex justify-content-between mt-2">
                                    <h2 class="text-start">
                                        <a asp-controller="Pie"
                                        asp-action="Details"
                                        asp-route-id="@pie.PieId"
                                        class="pie-link">@pie.Name</a>
                                    </h2>
                                    <h5 class="text-nowrap">
                                        @pie.Price.ToString("c")
                                    </h5>
                                </div>
                            </div>
                        </div>
                    </div>
                        }
                    </div>

                </div>
            </div>


        . Levante o projeto e verifique se na tela inicial está funcionando corretamente

            https://localhost:[porta]

        . Faça as alterações no arquivo "Views/Shared/_Layout.cshtml" abaixo:

            <!DOCTYPE html>

            <html>
            <head>
                <meta name="viewport" content="width=device-width" />
                <title>Bethany's Pie Shop</title>
                <link href='https://fonts.googleapis.com/css?family=Work+Sans' rel='stylesheet' type='text/css'>
                <script src="~/lib/jquery/dist/jquery.js"></script>
                <script src="~/lib/bootstrap/js/bootstrap.js"></script>
                <link href="~/css/site.css" rel="stylesheet" />
                <base href="/" />
            </head>
            <body>
                <div class="container">
                    <header>
                        <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-primary"
                            aria-label="Bethany's Pie Shop navigation header">
                            <div class="container-xl">
                                
                                <!-- Div "a" alterada -->
                                <a class="navbar-brand" asp-controller="Home" asp-action="Index">
                                    <img src="images/bethanys-pie-shop-logo_horiz-white.png" width="151" height="47" class="d-inline-block align-top mb-2 mt-1"
                                        alt="Bethany's Pie Shop Logo">
                                </a>
                                <!-- -->

                                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                                        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="navbar-toggler-icon"></span>
                                </button>

                                <!-- Div abaixo alterada totalmente -->
                                <div class="collapse navbar-collapse" id="navbarCollapse">
                                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                        <li class="nav-item">
                                            <a asp-controller="Home" asp-action="Index" class="nav-link">Home</a>
                                        </li>
                                        <li class="nav-item">
                                            <a asp-controller="Pie" asp-action="List" class="nav-link">Pies</a>
                                        </li>
                                    </ul>
                                </div>
                                <!-- -->

                            </div>
                        </nav>
                    </header>

                    @RenderBody()
                </div>
            </body>
            </html>

        . Levante o projeto e verifique se os links "Home" e "Pies" da tela inicial estão funcionando:

            https://localhost:[porta]


Improving the Views in the Application
======================================

    . Usando Partial Views

        . Partial Views

            . Ajuda evitar duplicação de código

            . São pedaços de uma view

            . Podem ser retornadas do controller

            . Pode ser chamadas a partir de outra view ou partial view.

        . O padrão de nome das "Partial Views" iniciam com "_".

        . As "Partial Views" são mantidas dentro da pasta "Shared"

        . Uma "Partial View" não é muito diferente de uma "View":

            @model Pie

            <div>
                <div class="thumnail">
                    <img src="@Model.ImageThumnailUrl" alt="">      <-------+
                    <h3>@Model.Price.ToString("c")</h3>                     |
                </div>                                                      |
            </div>                                                          |
                                                                            |
        . Usando a "Partial View":                                          |
                                                                            |
            @foreach( var pie in Model.Pies )                               |
            {                                                               |
                <partial name="_PieCard" model="pie" />                     |
            }       |              |                                        |
                    |              +----------------------------------------+
                    +---> Tag Helper

    . DEMO

        . Iremos retirar o trecho de código do arquivo "Index.cshtml", que apresenta os links "Pie" e colocá-lo
            na "Partial View" abaixo:

        . Crie a "Partial View" "_PieCard.cshtml" abaixo dentro da pasta "Shared":

            @model Pie

            <div class="col">
                <div class="card pie-card">
                    <img src="@Model.ImageThumbnailUrl" class="card-img-top" alt="@Model.Name">     <!-- Foi alterado de @Pie para @Model -->
                    <div class="card-body pie-button">
                        <h4 class="d-grid">
                            <a class="btn btn-secondary" 
                            asp-controller="ShoppingCart" 
                            asp-action="AddToShoppingCart"
                            asp-route-pieId="@Model.PieId"> + Add to cart</a>
                        </h4>
                        
                        <div class="d-flex justify-content-between mt-2">
                            <h2 class="text-start">
                                <a asp-controller="Pie"
                                asp-action="Details"
                                asp-route-id="@Model.PieId"
                                class="pie-link">@Model.Name</a>
                            </h2>
                            <h5 class="text-nowrap">
                                @Model.Price.ToString("c")
                            </h5>
                        </div>
                    </div>
                </div>
            </div>

        . Apague o trecho de código acima do arquivo "View/Home/Index.cshtml" e coloque o conteúdo como abaixo:

            ...
            <div class="text-center">
                <img src="Images/bethanys-pie-shop-logomark.png" class="logo-mark mx-auto" />
                <h1>Pies of the week</h1>
                <h5>Enjoy a weekly selection of our favorite pies</h5>

                <div class="row pies-of-the-week">
                    <div class="row row-cols-1 row-cols-md-3 g-4">
                        @foreach (var pie in Model.PiesOfTheWeek)
                        {

                        <!-- Trecho apagado

                        <div class="col">
                            <div class="card pie-card">
                                <img src="@pie.ImageThumbnailUrl" class="card-img-top" alt="@pie.Name">
                                <div class="card-body pie-button">
                                    <h4 class="d-grid">
                                    </h4>

                                    <div class="d-flex justify-content-between mt-2">
                                        <h2 class="text-start">
                                            <a asp-controller="Pie"
                                            asp-action="Details"
                                            asp-route-id="@pie.PieId"
                                            class="pie-link">@pie.Name</a>
                                        </h2>
                                        <h5 class="text-nowrap">
                                            @pie.Price.ToString("c")
                                        </h5>
                                    </div>
                                </div>
                            </div>
                        </div>

                        -->

                        <partial name="_PieCard" model="pie" />     <!-- Linha inserida -->


                        }
                    </div>

                </div>
            </div>

        . Acesse o arquivo "Views/Pie/List.cshtml" e substitua o código que lista "Pies" pela tag "Partial View" como abaixo:

            @model PieListViewModel

            <h1>@Model.CurrentCategory</h1>

            <div class="row row-cols-1 row-cols-md-3 g-4">

                @foreach (var pie in Model.Pies)
                {
                    <!-- Trecho eliminado

                    <div class="col">
                        <div class="card pie-card">
                            <img src="@pie.ImageThumbnailUrl" class="card-img-top" alt="@pie.Name">
                            <div class="card-body pie-button">
                                <h4 class="d-grid">
                                </h4>

                                <div class="d-flex justify-content-between mt-2">
                                    <h2 class="text-start">
                                        <a class="pie-link">@pie.Name</a>
                                    </h2>
                                    <h5 class="text-nowrap">
                                        @pie.Price.ToString("c")
                                    </h5>
                                </div>
                            </div>
                        </div>
                    </div>

                    -->

                    <partial name="_PieCard" model="pie" />     <!-- Linha inserida -->
                }

            </div>

        . Levante o projeto e verifique se a lista da página inicial e o link "Pies" da tela inicial estão funcionando:

            https://localhost:[porta]

        . Crie a "Partial View" "_Carroussel.cshtml" abaixo na pasta "Views/Shared" 

            <div id="carouselImages" class="carousel slide" data-bs-ride="true">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselImages" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselImages" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselImages" data-bs-slide-to="2" aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="~/Images/carousel1.jpg" class="d-block w-100" alt="Carousel image 1">
                    </div>
                    <div class="carousel-item">
                        <img src="~/Images/carousel2.jpg" class="d-block w-100" alt="Carousel image 2">
                    </div>
                    <div class="carousel-item">
                        <img src="~/Images/carousel3.jpg" class="d-block w-100" alt="Carousel image 3">
                    </div>
                </div>
            </div>

        . Substitua o trecho de código que fazia o carrossel pela "Partial View" no arquivo "Views/Home/Index.cshtml":

            @model HomeViewModel

            <!-- Trecho Eliminado 

            <div id="carouselImages" class="carousel slide" data-bs-ride="true">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselImages" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselImages" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselImages" data-bs-slide-to="2" aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="~/images/carousel1.jpg" class="d-block w-100" alt="Carousel image 1">
                    </div>
                    <div class="carousel-item">
                        <img src="~/images/carousel2.jpg" class="d-block w-100" alt="Carousel image 2">
                    </div>
                    <div class="carousel-item">
                        <img src="~/images/carousel3.jpg" class="d-block w-100" alt="Carousel image 3">
                    </div>
                </div>
            </div>
            -->

            <partial name="_Carroussel" />  <!-- Linha inserida -->

            ...

        . Levante o projeto e verifique se o carrossel da página inicial está funcionando:

            https://localhost:[porta]


    . Criando o "Shopping Cart"

        . Para criar um carrinho de compras precisaremos trabalhar:

            . Com sessões

            . Com "Cookies"

        . Para habilitar o uso de sessões precisamos ativar o "Middleware" abaixo:

            // Program.cs

            builder.Services.AddSession();
            builder.Services.AddHttpContextAccessor();

            ...

            app.UseSession();
    
    . DEMO

        . Crie a classe Model "ShoppingCatItem" dentro da pasta "Models":

            using System.ComponentModel.DataAnnotations;
            using System.ComponentModel.DataAnnotations.Schema;
            using Microsoft.EntityFrameworkCore;

            namespace bethanysPieShop.Models;

            [Table("ShoppingCartItem")]
            [Index(nameof(ShoppingCartId), nameof(ShoppingCartItemId), 
                    IsUnique = true,
                    Name = "idxShopCartItem_ShoppingCartId")]
            public class ShoppingCartItem
            {
                [Key]    
                [DatabaseGenerated( DatabaseGeneratedOption.Identity )]
                [Column("ShoppingCartItemId")]
                public int ShoppingCartItemId { get; set; }

                [Column("PiedId", TypeName = "INTEGER")]
                public int PieId { get; set; }

                [ForeignKey("PieId")]
                public Pie Pie  { get; set; } = default!;

                [Column("Amount", TypeName="INTEGER")]
                public int Amount { get; set; }

                [Column("ShoppingCartId", TypeName = "INTEGER")]
                public string? ShoppingCartId { get; set; }
            }

        . Insira a linha abaixo na classe "AppDbContext":

            using bethanysPieShop.Models;
            using Microsoft.EntityFrameworkCore;

            namespace bethanysPieShop.Data
            {
                public class AppDbContext : DbContext
                {
                    public DbSet<Category>? Categories { get; set; }
                    public DbSet<Pie>? Pies { get; set; }

                    public DbSet<ShoppingCartItem>? ShoppingCartItems { get; set; }  // Linha inserida

                    public AppDbContext(DbContextOptions<AppDbContext> options) : base(options)
                    {
                    }

                    //            protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder) 
                    //                        => optionsBuilder.UseSqlite();
                    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
                    {
                        optionsBuilder.UseSqlite();
                        optionsBuilder.LogTo(Console.WriteLine);
                    }


                }
            }

        . Na raiz do projeto execute os comandos abaixo:

            dotnet clean

            dotnet build

            dotnet ef migrations add [Nome da nova migration]

            dotnet ef database update

        . Crie a interface "IShoppingCart" abaixo na pasta "Models":

            namespace bethanysPieShop.Models
            {
                public interface IShoppingCart
                {
                    void AddToCart(Pie pie);
                    int RemoveFromCart(Pie pie);
                    List<ShoppingCartItem> GetShoppingCartItems();
                    void ClearCart();
                    decimal GetShoppingCartTotal();
                    List<ShoppingCartItem> ShoppingCartItems { get; set; }
                }
            }

        (17.55)

        . Crie a classe de implementação "ShoppingCart" abaixo na pasta "Models":

            using Microsoft.EntityFrameworkCore;

            namespace bethanysPieShop.Models
            {
                public class ShoppingCart : IShoppingCart
                {
                    private readonly AppDbContext _context;

                    public string? ShoppingCartId { get; set; }

                    public List<ShoppingCartItem> ShoppingCartItems { get; set; } = default!;

                    private ShoppingCart(AppDbContext context)
                    {
                        _context = context;
                    }

                    public static ShoppingCart GetCart(IServiceProvider services)
                    {
                        ISession? session = services.GetRequiredService<IHttpContextAccessor>()?.HttpContext?.Session;

                        AppDbContext context = services.GetService<AppDbContext>() ?? throw new Exception("Error initializing");

                        string cartId = session?.GetString("CartId") ?? Guid.NewGuid().ToString();

                        session?.SetString("CartId", cartId);

                        return new ShoppingCart(context) { ShoppingCartId = cartId };
                    }

                    public void AddToCart(Pie pie)
                    {
                        var shoppingCartItem =
                                _context.ShoppingCartItems.SingleOrDefault(
                                    s => s.Pie.PieId == pie.PieId && s.ShoppingCartId == ShoppingCartId);

                        if (shoppingCartItem == null)
                        {
                            shoppingCartItem = new ShoppingCartItem
                            {
                                ShoppingCartId = ShoppingCartId,
                                Pie = pie,
                                Amount = 1
                            };

                            _context.ShoppingCartItems.Add(shoppingCartItem);
                        }
                        else
                        {
                            shoppingCartItem.Amount++;
                        }
                        _context.SaveChanges();
                    }

                    public int RemoveFromCart(Pie pie)
                    {
                        var shoppingCartItem =
                                _context.ShoppingCartItems.SingleOrDefault(
                                    s => s.Pie.PieId == pie.PieId && s.ShoppingCartId == ShoppingCartId);

                        var localAmount = 0;

                        if (shoppingCartItem != null)
                        {
                            if (shoppingCartItem.Amount > 1)
                            {
                                shoppingCartItem.Amount--;
                                localAmount = shoppingCartItem.Amount;
                            }
                            else
                            {
                                _context.ShoppingCartItems.Remove(shoppingCartItem);
                            }
                        }

                        _context.SaveChanges();

                        return localAmount;
                    }

                    public List<ShoppingCartItem> GetShoppingCartItems()
                    {
                        return ShoppingCartItems ??=
                                _context.ShoppingCartItems.Where(c => c.ShoppingCartId == ShoppingCartId)
                                    .Include(s => s.Pie)
                                    .ToList();
                    }

                    public void ClearCart()
                    {
                        var cartItems = _context
                            .ShoppingCartItems
                            .Where(cart => cart.ShoppingCartId == ShoppingCartId);

                        _context.ShoppingCartItems.RemoveRange(cartItems);

                        _context.SaveChanges();
                    }

                    public decimal GetShoppingCartTotal()
                    {
                        // IMPORTANTE: Devido a incompatibilidade do tipo "decimal" da propriedade "Pie.Price" e o 
                        //              banco "Sqlite", o EF ao usar o método "SUM()" acusou erro. 
                        //             Para contornar o problema fui obrigado fazer a totalização manualmente.
                        //             Se for outro banco, como o SQLServer, provavelmente funcionará da forma
                        //              como está comentada abaixo.

                        // var total = _context.ShoppingCartItems.Where(c => c.ShoppingCartId == ShoppingCartId)
                        //     .Select(c => c.Pie.Price * c.Amount).Sum();

                        decimal total = 0M;

                        var shoppingCartItens = _context.ShoppingCartItems.Where(c => c.ShoppingCartId == ShoppingCartId)
                                        .Select(c => new { preco = c.Pie.Price  * c.Amount } ) 
                                        .ToList();

                        if ( shoppingCartItens != null )
                        {
                            shoppingCartItens.ForEach( item => {
                                total = total + item.preco;        
                            });
                        }

                        return total;
                    }
                }
            }

        . Insira as linhas abaixo no arquivo "Program.cs":

            using bethanysPieShop.Models;
            using Microsoft.EntityFrameworkCore;

            var builder = WebApplication.CreateBuilder(args);

            builder.Services.AddControllersWithViews();

            builder.Services.AddScoped<ICategoryRepository, CategoryRepository>();
            builder.Services.AddScoped<IPieRepository, PieRepository>();

            builder.Services.AddScoped<IShoppingCart, ShoppingCart>(sp => ShoppingCart.GetCart(sp));    // Linha inserida
            builder.Services.AddSession();                                                              // Linha inserida
            builder.Services.AddHttpContextAccessor();                                                  // Linha inserida

            builder.Services.AddDbContext<AppDbContext>( options => {                           
                options.UseSqlite( 
                    builder.Configuration["ConnectionStrings:DefaultConnection"]);
            });

            var app = builder.Build();

            //app.MapGet("/", () => "Hello World!");
            if (app.Environment.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
            }

            app.UseStaticFiles();
            app.UseSession();                                                   // Linha inserida

            //app.MapDefaultControllerRoute();

            app.MapControllerRoute(                                             // Linha alterada
                name: "default",
                pattern: "{controller=Home}/{action=Index}/{id?}");

            DbInitializer.Seed(app);

            app.Run();

        . Crie a classe "ViewModel" "ShoppingCartViewModel" na pasta "ViewModels" como abaixo:

            using bethanysPieShop.Models;

            namespace bethanysPieShop.ViewModels
            {
                public class ShoppingCartViewModel
                {
                    public ShoppingCartViewModel(IShoppingCart shoppingCart, decimal shoppingCartTotal)
                    {
                        ShoppingCart = shoppingCart;
                        ShoppingCartTotal = shoppingCartTotal;
                    }

                    public IShoppingCart ShoppingCart { get; }
                    public decimal ShoppingCartTotal { get; }
                }
            }

        . Crie a classe controller "ShoppingCartController.cs" abaixo na pasta "Controllers":

            using bethanysPieShop.Models;
            using bethanysPieShop.ViewModels;
            using Microsoft.AspNetCore.Mvc;

            namespace bethanysPieShop.Controllers
            {
                public class ShoppingCartController : Controller
                {
                    private readonly IPieRepository _pieRepository;
                    private readonly IShoppingCart _shoppingCart;

                    public ShoppingCartController(IPieRepository pieRepository, IShoppingCart shoppingCart)
                    {
                        _pieRepository = pieRepository;
                        _shoppingCart = shoppingCart;

                    }
                    public ViewResult Index()
                    {
                        var items = _shoppingCart.GetShoppingCartItems();
                        _shoppingCart.ShoppingCartItems = items;

                        var shoppingCartViewModel = new ShoppingCartViewModel(_shoppingCart, _shoppingCart.GetShoppingCartTotal());

                        return View(shoppingCartViewModel);
                    }

                    public RedirectToActionResult AddToShoppingCart(int pieId)
                    {
                        var selectedPie = _pieRepository.AllPies.FirstOrDefault(p => p.PieId == pieId);

                        if (selectedPie != null)
                        {
                            _shoppingCart.AddToCart(selectedPie);
                        }
                        return RedirectToAction("Index");
                    }

                    public RedirectToActionResult RemoveFromShoppingCart(int pieId)
                    {
                        var selectedPie = _pieRepository.AllPies.FirstOrDefault(p => p.PieId == pieId);

                        if (selectedPie != null)
                        {
                            _shoppingCart.RemoveFromCart(selectedPie);
                        }
                        return RedirectToAction("Index");
                    }
                }
            }

        . Crie a pasta "Views/ShoppingCart"

        . Dentro da pasta criada, crie a View "Index.cshtml" com o código abaixo:

            @model ShoppingCartViewModel

            <h3 class="my-5">
                Shopping cart
            </h3>


            <div class="row gx-3">
                <div class="col-8">
                    @foreach (var line in Model.ShoppingCart.ShoppingCartItems)
                    {
                        <div class="card shopping-cart-card mb-2">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="@line.Pie.ImageThumbnailUrl" class="img-fluid rounded-start p-2" alt="@line.Pie.Name">
                                </div>
                                <div class="col-md-8">
                                    <div class="card-body">
                                        <h5 class="card-text">@line.Amount x @line.Pie.Name</h5>
                                        <div class="d-flex justify-content-between">
                                            <h6>@line.Pie.ShortDescription</h6>
                                            <h2>@line.Pie.Price.ToString("c")</h2>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="col-4">
                    <div class="card shopping-cart-card p-3">
                        <div class="row">
                            <h4 class="col">Total:</h4>
                            <h4 class="col text-end">@Model.ShoppingCartTotal.ToString("c")</h4>
                        </div>
                        <hr />
                        <div class="text-center d-grid">
                            
                        </div>
                    </div>
                </div>
            </div>

        . Altere a View "~/View/Pie/Details.cshtml" com o conteúdo abaixo:

            @model Pie

            <h3 class="my-5">
                @Model.Name
            </h3>

            <div class="row gx-5">
                <img alt="@Model.Name" src="@Model.ImageUrl" class="img-fluid col-5" />
                <div class="col-7">
                    <h4>@Model.ShortDescription</h4>
                    <p>@Model.LongDescription</p>
                    <h3 class="pull-right">@Model.Price.ToString("c")</h3>
                    <div class="addToCart">
                        <p class="button">

                        <!-- Conteúdo inserido -->

                        <a class="btn btn-secondary" 
                            asp-controller="ShoppingCart" 
                            asp-action="AddToShoppingCart"
                            asp-route-pieId="@Model.PieId">
                            Add to cart
                        </a>

                        <!-- Fim da inserção -->


                        </p>
                    </div>
                </div>
            </div>

        (25.00)
        . Levante o projeto e verifique a partir do botão "Add Cart" de cada item está funcionando:

            https://localhost:[porta]

    . Trabalhando com "View Components"   

        . "View Components" trabalha de forma semelhante a "Partial Views". Serve para apresentar informações e reaproveitar
            código.

        . "View Components" implementam a interface "ViewComponent":

            public class ShoppingCartSummary: ViewComponent
            {
                public IViewComponentResult Invoke()
                {
                    return View( model );
                }
            }

        . "View Component" ficam normalmente armazenadas em subpasta dentro da pasta "Views/Shared/Components".

        . Para invocar um "View Component" podemos fazer de duas formas:

            @await Component.InvokeAsync("ShoppingCartSummary");

                    ou
            <vc:shopping-cart-summary></vc:shopping-cart-summary>

    (30.30)
    . DEMO

        . Crie a pasta "Components" na raiz do projeto

        . Dentro da pasta criada crie o "View Component" "ShoppingCartSummary" como abaixo:

            using bethanysPieShop.Models;
            using bethanysPieShop.ViewModels;
            using Microsoft.AspNetCore.Mvc;

            namespace bethanysPieShop.Components
            {
                public class ShoppingCartSummary: ViewComponent
                {
                    private readonly IShoppingCart _shoppingCart;

                    public ShoppingCartSummary(IShoppingCart shoppingCart)
                    {
                        _shoppingCart = shoppingCart;
                    }

                    public IViewComponentResult Invoke()
                    {
                        //var items = new List<ShoppingCartItem>() { new ShoppingCartItem(), new ShoppingCartItem() };

                        var items = _shoppingCart.GetShoppingCartItems();
                        _shoppingCart.ShoppingCartItems = items;

                        var shoppingCartViewModel = new ShoppingCartViewModel(_shoppingCart, _shoppingCart.GetShoppingCartTotal());

                        return View(shoppingCartViewModel);
                    }
                }
            }

        . Dentro da pasta "Components" crie o "View Component" "CategoryMenu.cs" como abaixo:

            using bethanysPieShop.Models;
            using Microsoft.AspNetCore.Mvc;

            namespace bethanysPieShop.Components
            {
                public class CategoryMenu : ViewComponent
                {
                    private readonly ICategoryRepository _categoryRepository;

                    public CategoryMenu(ICategoryRepository categoryRepository)
                    {
                        _categoryRepository = categoryRepository;
                    }

                    public IViewComponentResult Invoke()
                    {
                        var categories = _categoryRepository.AllCategories.OrderBy(c => c.CategoryName);
                        return View(categories);
                    }
                }
            }



        . Crie a pasta "Views/Shared/Components/ShoppingCartSummary"

        . Crie a classe "Razor View" "Default.cshtml" abaixo dentro da pasta criada:

            @model ShoppingCartViewModel

            @if (Model.ShoppingCart.ShoppingCartItems.Count > 0)
            {
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-cart3" viewBox="0 0 16 16">
                                <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
                            </svg>
                            <span id="cart-status">
                                @Model.ShoppingCart.ShoppingCartItems.Count
                            </span>
                        </a>
                    </li>
                </ul>
            }

        . Crie a pasta "Views/Shared/Components/CategoryMenu"

        . Crie a classe "Razor View" "Default.cshtml" abaixo dentro da pasta criada:

            @model IEnumerable<Category>

            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle"
                data-toggle="dropdown"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                id="nav-dropdown"
                aria-expanded="false">
                    Shop
                </a>
                <ul class="dropdown-menu" aria-labelledby="nav-dropdown">
                    @foreach (var category in Model)
                    {
                        <li>
                            <a asp-controller="Pie" asp-action="List"
                            asp-route-category="@category.CategoryName"
                            class="dropdown-item">
                                @category.CategoryName
                            </a>
                        </li>
                    }
                    <li>
                        <a asp-controller="Pie" asp-action="List" asp-route-Category="" class="dropdown-item">All pies</a>
                    </li>
                </ul>
            </li>



        . Insira a linha abaixo no arquivo "_ViewImports.cshtml":

            @using bethanysPieShop.Models    
            @using bethanysPieShop.ViewModels            

            @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers            
            @addTagHelper *, bethanysPieShop                         // Linha inserida, coloque o mesmo nome do "[nome projeto a ser importado].csproj"

        . Insira a linha abaixo no arquivo "View/Shared/_Layout.cshtml":

            <!DOCTYPE html>

            <html>
            <head>
                <meta name="viewport" content="width=device-width" />
                <title>Bethany's Pie Shop</title>
                <link href='https://fonts.googleapis.com/css?family=Work+Sans' rel='stylesheet' type='text/css'>
                <script src="~/lib/jquery/dist/jquery.js"></script>
                <script src="~/lib/bootstrap/js/bootstrap.js"></script>
                <link href="~/css/site.css" rel="stylesheet" />
                <base href="/" />
            </head>
            <body>
                <div class="container">
                    <header>
                        <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-primary"
                            aria-label="Bethany's Pie Shop navigation header">
                            <div class="container-xl">
                                <a class="navbar-brand" asp-controller="Home" asp-action="Index">
                                    <img src="images/bethanys-pie-shop-logo_horiz-white.png" width="151" height="47" class="d-inline-block align-top mb-2 mt-1"
                                        alt="Bethany's Pie Shop Logo">
                                </a>

                                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                                        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="navbar-toggler-icon"></span>
                                </button>

                                <div class="collapse navbar-collapse" id="navbarCollapse">
                                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                                        <!-- Linha Inserida -->
                                        <vc:category-menu></vc:category-menu>
                                        <!-- Fim da inserção -->

                                        <li class="nav-item">
                                            <a asp-controller="Contact" asp-action="Index" class="nav-link">Contact</a>
                                        </li>
                                    </ul>

                                    <!-- Linha Inserida -->
                                    <vc:shopping-cart-summary></vc:shopping-cart-summary>
                                    <!-- Fim da inserção -->

                                </div>
                            </div>
                        </nav>
                    </header>

                    @RenderBody()
                </div>
            </body>
            </html>

        . Acesse a classe "PieController" e substitua o método "List" pelo abaixo:

            ...
            public ViewResult List(string category)
            {
                IEnumerable<Pie> pies;
                string? currentCategory;

                if (string.IsNullOrEmpty(category))
                {
                    pies = _pieRepository.AllPies.OrderBy(p => p.PieId);
                    currentCategory = "All pies";
                }
                else
                {
                    pies = _pieRepository.AllPies.Where(p => p.Category.CategoryName == category)
                        .OrderBy(p => p.PieId);
                    currentCategory = _categoryRepository.AllCategories.FirstOrDefault(c => c.CategoryName == category)?.CategoryName;
                }

                return View(new PieListViewModel(pies, currentCategory));
            }
            ...


        . Levante o projeto e verifique a partir do botão "Add Cart":
        
            . Se aparece o icone de carrinho no topo da tela.

            . Se o menu ao lado do logo "Shop" está filtrando as categorias de "Pie"

            https://localhost:[porta]


    . Criando uma "Custom Tag Helper"

        . As Tag Helpers permitem que o código do lado do servidor participe na criação e renderização de 
            elementos HTML em arquivos Razor. Elas são um novo recurso semelhante aos HTML Helpers, 
            que nos ajudam a renderizar o HTML.

        . Caracteristicas de uma "Custom Tag Helper":

            . Implementam a interface "TagHelper"

            . Padrão de nomenclatura [nome da classe] + TagHelper

            . Sobrescreve os métodos Process/ProcessAsync

            . Resultado será um HTML

        . Exemplo de uma Custom Tag Helper:

            public class EmailTagHelper: TagHelper
            {
                public string? Address { get; set; }
                public string? Content { get; set; }

                public override void Process( TagHelperContext context, TagHelperOutput output )
                {
                    ...
                }
            }

            . Como usar uma "Custom Tag Helper":

                <email address="info@@bethanyspieshop.com"
                        content="Contact Us">
                </email>

            . A tag <email> executará o método "Process" da "Custom Tag Helper" "EmailTagHelper" e injetará
                o resultado no HTML da página que utilizou a tag <email>

        . Para fazer uso da TagHelper precimos fazer o import dela no arquivo "_ViewImports.cshtml"    

            @using bethanysPieShop.Models    
            @using bethanysPieShop.ViewModels            

            @addTagHelper bethanysPieShop.TagHelper.*, bethanysPieShop      // Linha inserida

            @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers            
            @addTagHelper *, bethanyPieShop                         

    (40.00)
    . DEMO

        . Crie o controller "ContactController" abaixo na abaixo na pasta "Controllers":

            using Microsoft.AspNetCore.Mvc;

            namespace bethanysPieShop.Controllers;
            public class ContactController : Controller
            {
                // GET: /<controller>/
                public IActionResult Index()
                {
                    return View();
                }
            }

        . Crie na pasta raiz a pasta "TagHelpers" e dentro dela crie a classe "TagHelper" "EmailTagHelper" abaixo:

            using Microsoft.AspNetCore.Razor.TagHelpers;

            namespace bethanysPieShop.TagHelpers
            {
                public class EmailTagHelper : TagHelper
                {
                    public string? Address { get; set; }
                    public string? Content { get; set; }

                    public override void Process(TagHelperContext context, TagHelperOutput output)
                    {
                        output.TagName = "a";

                        output.Attributes.SetAttribute("href", "mailto:" + Address);
                        output.Content.SetContent(Content);
                    }
                }
            }

        . Insira as linhas abaixo no arquivo "_ViewImports.cshtml":

            @using bethanysPieShop.Models    
            @using bethanysPieShop.ViewModels            

            @addTagHelper bethanysPieShop.TagHelpers.*, bethanysPieShop      // Linha inserida

            @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers            
            @addTagHelper *, bethanyPieShop                         

        . Insira a linha abaixo na "View" "View/Contact/Index.cshtml":

            <h3 class="my-5">
                Contact us
            </h3>

            <div class="row gx-5">
                <img src="~/images/contact/contact.jpg" class="img-fluid col-5"/>
                <div class="col-7">
                    <h1>We'd Love to Hear from You</h1>
                    <h5>Please contact us by sending an email using the button below</h5>

                    <!-- Linha inserida
                    <email address="info@@bethanyspieshop.com" content="Contact us" class="btn btn-secondary"></email>
                    <!-- Fim da inserção -->

                </div>
            </div>

        . Insira as linhas abaixo na "View" "Views/Shared/_Layout.cshtml":

            <!DOCTYPE html>

            <html>
            <head>
                <meta name="viewport" content="width=device-width" />
                <title>Bethany's Pie Shop</title>
                <link href='https://fonts.googleapis.com/css?family=Work+Sans' rel='stylesheet' type='text/css'>
                <script src="~/lib/jquery/dist/jquery.js"></script>
                <script src="~/lib/bootstrap/js/bootstrap.js"></script>
                <link href="~/css/site.css" rel="stylesheet" />
                <base href="/" />
            </head>
            <body>
                <div class="container">
                    <header>
                        <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-primary"
                            aria-label="Bethany's Pie Shop navigation header">
                            <div class="container-xl">
                                <a class="navbar-brand" asp-controller="Home" asp-action="Index">
                                    <img src="images/bethanys-pie-shop-logo_horiz-white.png" width="151" height="47" class="d-inline-block align-top mb-2 mt-1"
                                        alt="Bethany's Pie Shop Logo">
                                </a>

                                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                                        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="navbar-toggler-icon"></span>
                                </button>

                                <div class="collapse navbar-collapse" id="navbarCollapse">
                                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                        <vc:category-menu></vc:category-menu>

                                        <!-- Linha inserida -->
                                        <li class="nav-item">
                                            <a asp-controller="Contact" asp-action="Index" class="nav-link">Contact</a>
                                        </li>
                                        <!-- Fim da inserção -->

                                    </ul>
                                    <vc:shopping-cart-summary></vc:shopping-cart-summary>
                                </div>
                            </div>
                        </nav>
                    </header>

                    @RenderBody()
                </div>
            </body>
            </html>
            
        . Levante o projeto e verifique se no topo da tela aparece o link "Contact" e se está funcionando 
            o link "Contact Us" da página "ContactPage"

            https://localhost:[porta]

            . Verifique o "Source Code" da página "ContactPage" e verifique se o link do email foi inserido corretamente.

Working with Forms and Model Binding
====================================

    https://www.dotnettricks.com/learn/aspnetcore/aspnet-core-tag-helpers
    https://endjin.com/blog/2022/02/tag-helpers-in-aspnet-core
    https://endjin.com/blog/2022/01/model-binding-in-asp-net-core-using-razor-pages

    . As extensões "ASP.NET Helper" e "Razor Snippets" do VSCode ajuda bastante no desenvolvimento de páginas Razor, fazendo 
        "auto-complete" das "Tag Helpers"


Razor Snippets

    . Tópicos deste módulo:

        . Criando um formulário utilizando "Tag Helpers"

        . Entendendo "Model Binding"

        . Adicionando Validações

        . Recriando formulários utilizando "Razor Page"

    . Criando um formulário utilizando "Tag Helpers"

        . Principais "Tag Helpers":

            . Form Tag Helper

            . Input Tag Helper

            . Label Tag Helper

            . Textarea Tag Helper

            . Select Tag Helper

            . Validation Tag Helpers

        . Para fazermos uso das "Tag Helper" precisamos inserir a linha abaixo no arquivo "_ViewImports.cshtml":

            @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

        . Exemplo de uma "Tag Helper":

            . Label Tag Helper

                <!-- Tag Helper ->
                <label asp-for="Username" class="col-md-2 control-label"></label>  

                <!-- HTML Gerado -->
                <label class="col-md-2 control-label" for="Username">Username</label>

            . Form Tag Helpers

                <!-- Tag Helper -->
                <form asp-action="Subscribe" method="post" class="form-horizontal" role="form">

                <!-- HTML Gerado -->
                <form method="post" class="form-horizontal" role="form" action="/Subscriber/Subscribe">

                . Atributos do Form Tag Helper :

                    asp-controller      tag helper can be used to indicate which controller should be targeted by the 
                                        post action of a form.
                    asp-route-{value}   tag helper (where {value} can be replaced with the name of the parameter we want to 
                                        specify the value for) allows us to create a route.
                    asp-route           tag helper allows us to indicate which main route we want to use.
                    asp-forgery         tag helper allows us to prevent cross-site request forgery attacks on the 
                                        site when used with the [ValidateAntiForgeryToken] attribute in the HTTP 
                                        Post action method.
                    asp-action          To specify the controller action we want to target using tag helpers

            . Input Tag Helper

                <!-- Tag Helper -->
                <input asp-for="Username" class="form-control" />

                <!-- HTML Gerado -->
                <input class="form-control" 
                        type="text" 
                        data-val="true" 
                        data-val-length="Must be between 5 and 80 characters" 
                        data-val-length-max="80" 
                        data-val-length-min="5" 
                        data-val-required="Username is required" 
                        id="Username" 
                        maxlength="80" 
                        name="Username" value="" />

                . The attribute type will change according to the .NET data type or Data Annotation attribute applied 
                    to the model, such as [DataType(DataType.EmailAddress)] or [DataType(DataType.Password)].

                . Notice also the validation attributes generated. They are the data-val-* attributes and contain 
                    validation information based on the .NET data type and the data annotations in our model property.

        . Exemplo completo de um formulário:

            @model Subscriber

            <form asp-action="Subscribe" method="post" class="form-horizontal" role="form">
                <h4>Enter your details in order to subscribe.</h4>

                <div class="form-group">
                    <label asp-for="Username" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Username" class="form-control" />
                        <span asp-validation-for="Username" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label asp-for="Email" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Email" class="form-control" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label asp-for="Password" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Password" class="form-control" />
                        <span asp-validation-for="Password" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-offset-2 col-md-5">
                        <input type="submit" class="btn btn-primary" value="Subscribe" />
                    </div>
                </div>

            </form>
    
    (5.38)
    . DEMO

        . Inclua a classe "OrderDetail.cs" abaixo na pasta "Models":

            namespace bethanysPieShop.Models
            {
                public class OrderDetail
                {
                    public int OrderDetailId { get; set; }
                    public int OrderId { get; set; }
                    public int PieId { get; set; }
                    public int Amount { get; set; }
                    public decimal Price { get; set; }
                    public Pie Pie { get; set; } = default!;
                    public Order Order { get; set; } = default!;
                }
            }

        . Inclua a classe "Order.cs" abaixo na pasta "Models":

            using Microsoft.AspNetCore.Mvc.ModelBinding;
            using System.ComponentModel.DataAnnotations;

            namespace bethanysPieShop.Models
            {
                public class Order
                {
                    public int OrderId { get; set; }

                    public List<OrderDetail>? OrderDetails { get; set; }

                    public string FirstName { get; set; } = string.Empty;

                    public string LastName { get; set; } = string.Empty;

                    public string AddressLine1 { get; set; } = string.Empty;

                    public string? AddressLine2 { get; set; }

                    public string ZipCode { get; set; } = string.Empty;

                    public string City { get; set; } = string.Empty;

                    public string? State { get; set; }

                    public string Country { get; set; } = string.Empty;

                    public string PhoneNumber { get; set; } = string.Empty;

                    public string Email { get; set; } = string.Empty;

                    public decimal OrderTotal { get; set; }

                    public DateTime OrderPlaced { get; set; }
                }
            }

        . Inclua a interface "IOrderRepository" abaixo na pasta "Models":

            namespace bethanysPieShop.Models
            {
                public interface IOrderRepository
                {
                    void CreateOrder(Order order);
                }
            }

        . Insira as linhas abaixo na classe "Data/AppDbContext.cs"

            using bethanysPieShop.Models;
            using Microsoft.EntityFrameworkCore;

            namespace bethanysPieShop.Data
            {
                public class AppDbContext : DbContext
                {
                    public DbSet<Category>? Categories { get; set; }
                    public DbSet<Pie>? Pies { get; set; }
                    public DbSet<Order> Orders { get; set; }                // Linha Inserida
                    public DbSet<OrderDetail> OrderDetails { get; set; }    // Linha Inserida


                    public DbSet<ShoppingCartItem>? ShoppingCartItems { get; set; }

                    public AppDbContext(DbContextOptions<AppDbContext> options) : base(options)
                    {
                    }

                    //            protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder) 
                    //                        => optionsBuilder.UseSqlite();
                    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
                    {
                        optionsBuilder.UseSqlite();
                        optionsBuilder.LogTo(Console.WriteLine);
                    }


                }
            }


        . Inclua a classe "OrderRepository.cs" abaixo na pasta "Models":

            namespace bethanysPieShop.Models
            {
                public class OrderRepository : IOrderRepository
                {
                    private readonly AppDbContext _bethanysPieShopDbContext;
                    private readonly IShoppingCart _shoppingCart;

                    public OrderRepository(AppDbContext bethanysPieShopDbContext, IShoppingCart shoppingCart)
                    {
                        _bethanysPieShopDbContext = bethanysPieShopDbContext;
                        _shoppingCart = shoppingCart;
                    }

                    public void CreateOrder(Order order)
                    {
                        order.OrderPlaced = DateTime.Now;

                        List<ShoppingCartItem>? shoppingCartItems = _shoppingCart.ShoppingCartItems;
                        order.OrderTotal = _shoppingCart.GetShoppingCartTotal();

                        order.OrderDetails = new List<OrderDetail>();

                        foreach (ShoppingCartItem? shoppingCartItem in shoppingCartItems)
                        {
                            var orderDetail = new OrderDetail
                            {
                                Amount = shoppingCartItem.Amount,
                                PieId = shoppingCartItem.Pie.PieId,
                                Price = shoppingCartItem.Pie.Price
                            };

                            order.OrderDetails.Add(orderDetail);
                        }

                        _bethanysPieShopDbContext.Orders.Add(order);

                        _bethanysPieShopDbContext.SaveChanges();
                    }
                }
            }

        . Acesse a classe "Program.cs" e insira as linhas abaixo:

            ...
            var builder = WebApplication.CreateBuilder(args);

            builder.Services.AddScoped<ICategoryRepository, CategoryRepository>();      
            builder.Services.AddScoped<IPieRepository, PieRepository>();     
            builder.Services.AddScoped< IShoppingCart, ShoppingCart >( sp => ShoppingCart.GetCart( sp ) );          

            builder.Services.AddScoped<IOrderRepository, OrderRepository>();        // Linha inserida

            ...

        . Execute o comando abaixo na pasta raiz do projeto:

            dotnet clean

            dotnet build

            dotnet ef migrations add [Nome da nova migration]

            dotnet ef database update

        . Acesse o banco e verifique se as tabelas "Order" e "OrderDetail" foram criadas com sucesso.

        . Crie a classe "OrderController" abaixo dentro da pasta "Controllers":

            using bethanysPieShop.Models;
            using Microsoft.AspNetCore.Mvc;

            namespace bethanysPieShop.Controllers
            {
                public class OrderController : Controller
                {
                    private readonly IOrderRepository _orderRepository;
                    private readonly IShoppingCart _shoppingCart;

                    public OrderController(IOrderRepository orderRepository, IShoppingCart shoppingCart)
                    {
                        _orderRepository = orderRepository;
                        _shoppingCart = shoppingCart;
                    }

                    public IActionResult Checkout()
                    {
                        return View();
                    }
                }
            }

        . Crie a View "Checkout.cshtml" abaixo dentro da pasta "Views/Order":

            @model Order

            <form asp-action="Checkout" method="post" role="form">
                <h3 class="my-5">
                    You're just one step away from your delicious pies.
                </h3>

                <div asp-validation-summary="All" class="text-danger"></div>

                <div class="col-6">
                    <div class="row g-2">
                        <div class="col-12">
                            <label asp-for="FirstName" class="form-label"></label>
                            <input asp-for="FirstName" class="form-control" />
                            <span asp-validation-for="FirstName" class="text-danger"></span>
                        </div>

                        <div class="col-12">
                            <label asp-for="LastName" class="form-label"></label>
                            <input asp-for="LastName" class="form-control" />
                            <span asp-validation-for="LastName" class="text-danger"></span>
                        </div>

                        <div class="col-12">
                            <label asp-for="AddressLine1" class="form-label"></label>
                            <input asp-for="AddressLine1" class="form-control" />
                            <span asp-validation-for="AddressLine1" class="text-danger"></span>
                        </div>

                        <div class="col-12">
                            <label asp-for="AddressLine2" class="form-label"></label>
                            <input asp-for="AddressLine2" class="form-control" />
                            <span asp-validation-for="AddressLine2" class="text-danger"></span>
                        </div>

                        <div class="col-6">
                            <label asp-for="City" class="form-label"></label>
                            <input asp-for="City" class="form-control" />
                            <span asp-validation-for="City" class="text-danger"></span>
                        </div>

                        <div class="col-6">
                            <label asp-for="State" class="form-label"></label>
                            <input asp-for="State" class="form-control" />
                            <span asp-validation-for="State" class="text-danger"></span>
                        </div>

                        <div class="col-6">
                            <label asp-for="ZipCode" class="form-label"></label>
                            <input asp-for="ZipCode" class="form-control" />
                            <span asp-validation-for="ZipCode" class="text-danger"></span>
                        </div>

                        <div class="col-6">
                            <label asp-for="Country" class="form-label"></label>
                            <input asp-for="Country" class="form-control" />
                            <span asp-validation-for="Country" class="text-danger"></span>
                        </div>

                        <div class="col-12">
                            <label asp-for="Email" class="form-label"></label>
                            <input asp-for="Email" class="form-control" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>

                        <div class="col-12">
                            <label asp-for="PhoneNumber" class="form-label"></label>
                            <input asp-for="PhoneNumber" class="form-control" />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="mt-2">
                        <div class="col-md-offset-2 col-md-5">
                            <input type="submit" class="btn btn-secondary" value="Complete order" />
                        </div>
                    </div>
                </div>
            </form>

        . Insira as linhas abaixo na classe "Views/ShoppingCart/Index.cshtml":

            @model ShoppingCartViewModel

            <h3 class="my-5">
                Shopping cart
            </h3>


            <div class="row gx-3">
                <div class="col-8">
                    @foreach (var line in Model.ShoppingCart.ShoppingCartItems)
                    {
                        <div class="card shopping-cart-card mb-2">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="@line.Pie.ImageThumbnailUrl" class="img-fluid rounded-start p-2" alt="@line.Pie.Name">
                                </div>
                                <div class="col-md-8">
                                    <div class="card-body">
                                        <h5 class="card-text">@line.Amount x @line.Pie.Name</h5>
                                        <div class="d-flex justify-content-between">
                                            <h6>@line.Pie.ShortDescription</h6>
                                            <h2>@line.Pie.Price.ToString("c")</h2>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="col-4">
                    <div class="card shopping-cart-card p-3">
                        <div class="row">
                            <h4 class="col">Total:</h4>
                            <h4 class="col text-end">@Model.ShoppingCartTotal.ToString("c")</h4>
                        </div>
                        <hr />
                        <div class="text-center d-grid">

                            @*
                                Linhas abaixo inserida
                            *@

                            <a class="btn btn-secondary" 
                                asp-controller="Order" 
                                asp-action="Checkout">
                            <h4>Check out now!</h4></a>

                            @* Fim da inserção *@
                            
                        </div>
                    </div>
                </div>
            </div>

        . Levante a aplicação, acione o "Add cart" e verifique dentro do carrinho se aparece o botão "CHECK OUT NOW".

            . A funcionalidade está incompleta, somente verifique se o botão "CHECK OUT NOW" apareceu. No próximo DEMO
                essa funcionalidade será completada.

    (14.50)
    . Entendendo "Model Binding"

        . Model Bindings podem ser dividido em dois grupos:

            . Tipos simples: O binding source pode ser valores de rota, string de consulta e dados de formulário.

                http://www.meusite.com/blog/posts/5 ----+
                                                        |   Mapeia o "id" com o valor da rota
                                                        V
                        public IActionResult Detail(int id) => View();

            . Tipos Complexos: O binding source pode ser uma string de consulta e/ou dados de formulário.

                . O model binding da ASP.NET Core mapeia dados de requisições HTTP para parâmetros dos métodos Action dos controladores,
                    por exemplo:

                    . Razor page "Checkout.cshtml":

                        @model Order

                        <form asp-action="Checkout" method="post" role="form">
                            ...                                                 ----+
                        </form>                                                     |
                                                                                    |
                    . Controller "OrderController.cs":                              |
                                                                                    |
                        using bethanysPieShop.Models;                               |
                        using Microsoft.AspNetCore.Mvc;                             |
                                                                                    |
                        namespace bethanysPieShop.Controllers                       |
                        {                                                           |
                            public class OrderController : Controller               |
                            {                                                       |
                                ...                                                 |
                                                                      +-------------+
                                                                      |     Mapeia todos os inputs do formulário no
                                [HttpPost]                            V     objeto "order"
                                public IActionResult Checkout(Order order)
                                {
                                    var items = _shoppingCart.GetShoppingCartItems();
                                    _shoppingCart.ShoppingCartItems = items;

                                    if (_shoppingCart.ShoppingCartItems.Count == 0)
                                    {
                                        ModelState.AddModelError("", "Your cart is empty, add some pies first");
                                    }

                                    if (ModelState.IsValid)
                                    {
                                        _orderRepository.CreateOrder(order);
                                        _shoppingCart.ClearCart();
                                        return RedirectToAction("CheckoutComplete");
                                    }
                                    return View(order);
                                }

                                ...
                            }
                        }

        . Podemos fazer uso de annotation para informar ao "Model Binding" qual é a sua fonte:

            . A lista de annotation possíveis na assinatura dos métodos são:

                . FromForm

                    Este atributo faz com que o Model Binder utilize somente os dados recebidos do formulário enviado.

                        public IActionResult Detail([FromForm] ProdutoViewModel produtoViewModel) => View(produtoViewModel);

                . FromRoute

                    Este atributo faz com que o Model Binder apenas vincule dados que são oriundos da rota de dados

                        public IActionResult Detail([FromRoute] int id) => View();

                . FromQuery

                    Este atributo diz ao Model Binder para receber apenas os dados da cadeia de consulta (querystring).

                        public IActionResult Detail([FromQuery] int id) => View();

                        . Se fizermos uma solicitação com a URL:  Produto/Detalhe/2?Id=4 . O valor 4 será vinculado e não o 
                            valor 2 conforme seria previsto no comportamento padrão.

                . FromHeader

                    Este atributo diz ao Model Binder para vincular os valores que vêm no cabeçalho da requisição HTTP.

                . FromBody

                    Este atributo diz ao Model Binder para vincular dados a partir do Body do request.

                        public IActionResult Detail([FromBody] ProdutoViewModel produtoViewModel) => View(produtoViewModel);

                . FromServices

                    Este atributo vincula o valor especificado à implementação que foi configurada no seu container de injeção de dependência.

                    public IActionResult Detail([FromServices] IPrintable printer) => View();

                . Bind e BindNever    

                    Este atributo vincula o valor especificado à implementação que foi configurada no seu container de injeção de dependência.

                    O atributo BindNever diz ao model binder que não deve vincular o atributo especificado.

                    Como você pode ver no trecho de código abaixo, IsAdminUser nunca será vinculado.

                    Esta abordagem pode ser chamada de propriedades de lista negra, o que não é uma boa prática de segurança.

                    É melhor listar os atributos que queremos vincular usando o atributo Bind, deixando de fora os que não queremos, 
                    como você pode ver no exemplo:
                    
                        BindNever
                        ---------
                        public class ProdutoViewModel
                        {
                            [FromQuery]
                            public int ProdutoId { get; set; }
                            public string ProdutoName { get; set; }
                            [BindNever]
                            public string IsAdminUser { get; set; }
                        }	

                        Bind
                        ----
                        [Bind(nameof(ProdutoId), nameof(ProdutoNome))]
                        public class ProdutoViewModel
                        {
                            [FromQuery]
                            public int ProdutoId { get; set; }
                            public string ProdutoNome { get; set; }
                            public string IsAdminUser { get; set; }
                        }

            . Podemos usar essas annotations na assinatura dos métodos, ou diretamentamente nos "models", como por exemplo
                no código acima.

        . DEMO

            . Insira os métodos abaixo na classe "OrderController.cs":

                ...
                [HttpPost]
                public IActionResult Checkout(Order order)
                {
                    var items = _shoppingCart.GetShoppingCartItems();
                    _shoppingCart.ShoppingCartItems = items;

                    if (_shoppingCart.ShoppingCartItems.Count == 0)
                    {
                        ModelState.AddModelError("", "Your cart is empty, add some pies first");
                    }

                    if (ModelState.IsValid)
                    {
                        _orderRepository.CreateOrder(order);
                        _shoppingCart.ClearCart();
                        return RedirectToAction("CheckoutComplete");
                    }
                    return View(order);
                }

                public IActionResult CheckoutComplete()
                {
                    ViewBag.CheckoutCompleteMessage = "Thanks for your order. You'll soon enjoy our delicious pies!";
                    return View();
                }

                ...

            . Crie a View "CheckoutComplete.cshtml" abaixo dentro da pasta "Views/Order":

                <h3 class="my-5">
                    @ViewBag.CheckoutCompleteMessage
                </h3>

            . Levante a aplicação, acione o "Add cart" e verifique dentro do carrinho se aparece o botão "CHECK OUT NOW".

                . Acione o botão "CHECK OUT NOW"

                . Inclua as informações da ordem e faça a gravação das informações.

        (24.30)
    . Adicionando validação

        https://www.tektutorialshub.com/asp-net-core/asp-net-core-model-validation/#modelstate-properties

        . Para mais detalhes sobre "ModelState" retorne a aula "Aula 34. Validações" e "Aula 36.  Padronizando erros" 
            do curso "Fundamentos ASP.NET 6 - Balta".

        . Suponha que de alguma forma os dados a serem submetidos para o controller esteja da seguinte forma:


            Add  "Order"  ------------------------------------> public ViewResult Add( Order order )
                                                                                             ^
                                                                                             |
            OrderId="ABC"        ------------------------------------------------------------+  Dados Inválidos                                                       
            Total="Hello World"
            
        . Podemos validar a situação acima com o objeto "ModelState". Veja o código abaixo no nosso "Controller":

            if (ModelState.IsValid)
            {
                _orderRepository.CreateOrder(order);

                return RedirectToAction("CheckoutComplete");
            }else
            {
                return View();
            }

        . Se utilizarmos as annotations de validação ([Required], [MaxLength], etc) no nosso model. Tudo isso será
            usado pelo objeto "ModelState" para validar a entrada.

        . Propriedades do "ModelState":

            . IsValid               Indicates if it was possible to bind the incoming values from the request to the model 
                                    correctly and whether any explicitly specified validation rules were broken during the 
                                    model binding process

            . GetValidationState    Returns the aggregate ModelValidationState for items starting with the specified key.

            . AddModelError         Adds the specified error message to the Errors instance that is associated with the 
                                    specified key.

            . Clear                 Removes all keys and values from this instance of ModelStateDictionary.

            . ClearValidationState(String) Clears ModelStateDictionary entries that match the key that is passed as the parameter.

            . GetFieldValidationState(String) Returns the aggregate ModelValidationState for items starting with the specified key.

            . TryAddModelError(String, Exception, ModelMetadata) Attempts to add the specified exception to the Errors instance 
                                                                    that is associated with the specified key.            

        . Obtendo uma lista de erros: 
 
            foreach (var modelStateKey in ModelState.Keys)
            {
                var modelStateVal = ModelState[modelStateKey];
                foreach (var error in modelStateVal.Errors)
                {
                    var key = modelStateKey;
                    var errorMessage = error.ErrorMessage;
                }
            }
 
        . Adicionando uma mensagem de erro customizada: 
 
            if (ModelState.IsValid) { 
                If (someService.IsProductExists(model)) { 
                    ModelState.AddModelError("", “Product already exists”); 
                    return View(model); 
                } else { 
                    return View(model); 
                } 
            }
 
    . Validações

        . Podem ser inseridas nas classes models, através de "annotations"

            . Constraints
            . Required
            . Regex
            . Custom Validation


    . Tipos:

        . Fluent Mapping

            . Mapeamento fluente
            . Feito em uma classe externa
            . Não "polui" a classe principal
            . Não cria dependências na classe/projeto principal

        . Data Annotations

            . Feitos diretamente nas classes
            . Mais simples e diretos
            . Depende do System.ComponentModel.DataAnnotations
                . Alguns dependem do Microsof.EntityFrameworkCore 

    . Principais annotations:

        . Required
        . StringLength
        . Range
        . RegularExpression
        . EmailAddress
        . Phone

    . Mais detalhes, acesse as aulas do curso "Fundamentos do Entity Framework - Balta" entre as aulas
        16 a 19.

    . Exemplo:

        public class Order
        {
            [Required(ErrorMessage="Enter your first name)]
            [StringLength(50)]
            public string FirstName { get; set; }
        }


    . A "Tag Helper" "asp-validation-summary" são usadas para renderizar as mensagens de erro de validação 

        <form asp-action="Checkout" method="post">
            <div asp-validation-summary="All" class="text-danger">
            </div>                        |
        </form>                           +-------------------------+
                                                                    |
        . Possible ValidationSummary enumeration values are:        |
                                                                    |
            Enum	    Description    <----------------------------+
            ----        -----------
            None	    providing no validation summary (the default)
            ModelOnly	summarising only model validation errors
            All	        summarising model and property validation errors
    

        . O resultado renderizado será:

            <div class="validation-summary-errors" data-valmsg-summary="true">
                <ul>
                    <li>The FirstName field is required.</li>
                    <li>The LastName field is required.</li>
                    <li>The DateOfBirth field is required.</li>
                </ul>
            </div>

        . Poderiamos deixar mais amigável a validação da seguinte forma:

            <form asp-action="Checkout" method="post">
                <div asp-validation-summary="All" class="text-danger">
                    <span>Please correct the following errors</span>    <!-- Msg Inserida -->
                </div>                        
            </form>                           

    (30.00)
    . DEMO

        . Altere a classe "Model" "Models/Order" como abaixo, colocando as annotations:

            using Microsoft.AspNetCore.Mvc.ModelBinding;
            using System.ComponentModel.DataAnnotations;

            namespace bethanysPieShop.Models
            {
                public class Order
                {
                    [BindNever]
                    public int OrderId { get; set; }

                    public List<OrderDetail>? OrderDetails { get; set; }

                    [Required(ErrorMessage = "Please enter your first name")]
                    [Display(Name = "First name")]
                    [StringLength(50)]
                    public string FirstName { get; set; } = string.Empty;

                    [Required(ErrorMessage = "Please enter your last name")]
                    [Display(Name = "Last name")]
                    [StringLength(50)]
                    public string LastName { get; set; } = string.Empty;

                    [Required(ErrorMessage = "Please enter your address")]
                    [StringLength(100)]
                    [Display(Name = "Address Line 1")]
                    public string AddressLine1 { get; set; } = string.Empty;

                    [Display(Name = "Address Line 2")]
                    public string? AddressLine2 { get; set; }

                    [Required(ErrorMessage = "Please enter your zip code")]
                    [Display(Name = "Zip code")]
                    [StringLength(10, MinimumLength = 4)]
                    public string ZipCode { get; set; } = string.Empty;

                    [Required(ErrorMessage = "Please enter your city")]
                    [StringLength(50)]
                    public string City { get; set; } = string.Empty;

                    [Required( ErrorMessage = "Please enter your State")]
                    [StringLength( 10, ErrorMessage="Length State must be between 2 and 10 digits", MinimumLength = 2)]
                    public string? State { get; set; }

                    [Required(ErrorMessage = "Please enter your country")]
                    [StringLength(50)]
                    public string Country { get; set; } = string.Empty;

                    [Required(ErrorMessage = "Please enter your phone number")]
                    [StringLength(25)]
                    [DataType(DataType.PhoneNumber)]
                    [Display(Name = "Phone number")]
                    public string PhoneNumber { get; set; } = string.Empty;

                    [Required]
                    [StringLength(50)]
                    [DataType(DataType.EmailAddress)]
                    [RegularExpression(@"(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|""(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*"")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])",
                        ErrorMessage = "The email address is not entered in a correct format")]
                    public string Email { get; set; } = string.Empty;

                    [BindNever]
                    public decimal OrderTotal { get; set; }

                    [BindNever]
                    public DateTime OrderPlaced { get; set; }
                }
            }

        . Insira a linha abaixo na view "Views/Order/Checkout.cshtml":

            <form asp-action="Checkout" method="post" role="form">
                <h3 class="my-5">
                    You're just one step away from your delicious pies.
                </h3>

                <div asp-validation-summary="All" class="text-danger"></div>                @* linha inserida *@

                <div class="col-6">
                    <div class="col-12">
                        <label asp-for="FirstName" class="form-label"></label>
                        <input asp-for="FirstName" class="form-control" />
                        <span asp-validation-for="FirstName" class="text-danger"></span>    @* linha inserida *@
                    </div>

                    <div class="col-12">
                        <label asp-for="LastName" class="form-label"></label>
                        <input asp-for="LastName" class="form-control" />
                        <span asp-validation-for="LastName" class="text-danger"></span>     @* linha inserida *@
                    </div>

                    <div class="col-12">
                        <label asp-for="AddressLine1" class="form-label"></label>
                        <input asp-for="AddressLine1" class="form-control" />
                        <span asp-validation-for="AddressLine1" class="text-danger"></span> @* linha inserida *@
                    </div>

                    <div class="col-12">
                        <label asp-for="AddressLine2" class="form-label"></label>
                        <input asp-for="AddressLine2" class="form-control" />
                        <span asp-validation-for="AddressLine2" class="text-danger"></span> @* linha inserida *@
                    </div>

                    <div class="col-6">
                        <label asp-for="City" class="form-label"></label>
                        <input asp-for="City" class="form-control" />
                        <span asp-validation-for="City" class="text-danger"></span>         @* linha inserida *@
                    </div>

                    <div class="col-6">
                        <label asp-for="State" class="form-label"></label>
                        <input asp-for="State" class="form-control" />
                        <span asp-validation-for="State" class="text-danger"></span>        @* linha inserida *@
                    </div>

                    <div class="col-6">
                        <label asp-for="ZipCode" class="form-label"></label>
                        <input asp-for="ZipCode" class="form-control" />
                        <span asp-validation-for="ZipCode" class="text-danger"></span>      @* linha inserida *@
                    </div>

                    <div class="col-6">
                        <label asp-for="Country" class="form-label"></label>
                        <input asp-for="Country" class="form-control" />
                        <span asp-validation-for="Country" class="text-danger"></span>      @* linha inserida *@
                    </div>

                    <div class="col-12">
                        <label asp-for="Email" class="form-label"></label>
                        <input asp-for="Email" class="form-control" />
                        <span asp-validation-for="Email" class="text-danger"></span>        @* linha inserida *@
                    </div>

                    <div class="col-12">
                        <label asp-for="PhoneNumber" class="form-label"></label>
                        <input asp-for="PhoneNumber" class="form-control" />
                        <span asp-validation-for="PhoneNumber" class="text-danger"></span>  @* linha inserida *@
                    </div>
                </div>
            </form>

        . Levante a aplicação e verifique se as v alidações estão funcionando na parte do "Checkout"

        . Validação feita através do JQuery:

            . Instale a biblioteca JQuery abaixo no projeto:

                jquery-validate@1.19.4

                . No visual studio:

                    . Clique com o botão direito do mouse sobre a raiz do projeto
                    . Escolha a opção: Add / Client Side Library
                    . No item "Library" digite "jquery-validate@1.19.4"
                    . Escolha todas as opção para instalação da biblioteca

                . No VSCode:

                    . Acesse a URL abaixo e faça o download:

                        https://sourceforge.net/projects/jquery-validation.mirror/files/1.19.4/jquery-validation-1.19.4.zip/download

                    . Crie a pasta "wwwroot/lib/jquery-validate" no projeto

                    . Copie a pasta "/dist" do arquivo baixado para dentro da pasta do projeto "wwwroot/lib/jquery-validate"

            (35.00)
            . Instale a bibliote JQuer abaixo no projeto:

                jquery-validation-unobtrusive@3.2.12

                . Execute o comando abaixo:

                    npm install jquery-validation-unobtrusive@3.2.12

                . Crie a pasta "wwwroot/lib/query-validation-unobtrusive" no projeto

                . Copie a pasta "/dist" do arquivo baixado para dentro da pasta do projeto "wwwroot/lib/query-validation-unobtrusive"

            . Acesse o arquivo "Views/Shared/_Layout.cshtml" e implemente as linhas abaixo:

                <!DOCTYPE html>

                <html>
                <head>
                    <meta name="viewport" content="width=device-width" />
                    <title>Bethany's Pie Shop</title>
                    <link href='https://fonts.googleapis.com/css?family=Work+Sans' rel='stylesheet' type='text/css'>
                    <script src="~/lib/jquery/dist/jquery.js"></script>
                    <script src="~/lib/jquery-validate/jquery.validate.js"></script>                                @* linha inserida *@
                    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>      @* linha inserida *@
                    <script src="~/lib/bootstrap/js/bootstrap.js"></script>
                    <link href="~/css/site.css" rel="stylesheet" />
                    <base href="/" />
                </head>
                <body>
                    ...
                </body>
                </html>

            . Levante a aplicação e verifique se as v alidações estão funcionando na parte do "Checkout"

    . Recriando o formulário utilizando um Razor Page

        https://www.learnrazorpages.com/
        https://www.learnrazorpages.com/first-look

                            ASP.NET Core Application Frameworks
                ----------------------------------------------------------------    

                ASP.NET Core            ASP.NET Core                ASP.NET Core
                    MVC                 Razor Pages                     Blazor


                            ASP.NET Core Plataform
                ---------------------------------------------

                KESTREL         Middleware          Razor

                Model           Dependency          Logging
                Binding         Injection

        . Razor Pages é mais uma opção de renderização de página dentro do ASP.NET Core para geração de HTML.

        . Configurando a aplicação para Razor Pages

            . Acesse o componente "Program.cs" e acrescente as linhas abaixo:

                ...
                builder.Services.AddRazorPages();

                app.MapRazorPages();
                ...

        . Exemplos de "Razor Pages"

            . Arquivo único

                @page                                       // Diretiva obrigatoria ser colocada no topo do arquivo.

                @{                                          // Bloco padrão C#
                    var name = string.Empty;
                    if (Request.HasFormContentType)         // Verifica se a requisição foi postada de "form html"
                    {
                        name = Request.Form["name"];
                    }
                }
                <div style="margin-top:30px;">
                    <form method="post">
                        <div>Name: <input name="name" /></div>
                        <div><input type="submit" /></div>
                    </form>
                </div>
                <div>
                    @if (!string.IsNullOrEmpty(name))
                    {
                        <p>Hello @name!</p>
                    }
                </div>

            . Arquivos "PageModel"

                . Modo mais recomendado para se trabalhar

                . Compartilha as informações entre dois componentes: [nome].cshtml e [nome].cshtml.cs

                . Exemplo:

                    Example.cshtml:

                    @page
                    @model ExampleModel
                    <div style="margin-top:30px;">
                        <form method="post">
                            <div>Name: <input asp-for="Name" /></div>
                            <div><input type="submit" /></div>
                        </form>
                        @if (!string.IsNullOrEmpty(Model.Name))
                        {
                            <p>Hello @Model.Name!</p>
                        }
                    </div>

                    Example.cshtml.cs:

                    using Microsoft.AspNetCore.Mvc;
                    using Microsoft.AspNetCore.Mvc.RazorPages;
                    namespace RazorPages.Pages
                    {
                        public class ExampleModel : PageModel
                        {
                            [BindProperty]                      // Faz a ligação dos valores do formulário com o componente Model, 
                            public string Name { get; set; }    // Origem da informação: <div>Name: <input asp-for="Name" /></div>

                            public void OnGet()             // Quando houver uma requisição via "Get", esse método é chamada automaticamente
                            {

                            }

                            public void OnPost()             // Quando houver uma requisição via "Post", esse método é chamada automaticamente
                            {

                            }

                            // Se colocarmos na assinatura dos métodos "OnGet()" e "OnPost()" parâmetros, os valores deles serão os mesmos dos campos do formulário "cshtml".
                            // Para isso o nome dos campos do formulário e os parâmetros devem ser os mesmos.

                        }
                    }

        . Para mais possibilidades de como ligar (Bind) as informações do formulário com o Model acesse o link abaixo:

            https://www.learnrazorpages.com/razor-pages/model-binding

        . Estrutura de pastas de uma aplicação "Razor Pages":

            pasta "bin"
            pasta "obj"
            pasta "Pages"               ------> Localização padrão dos arquivo "Razor Pages"
                pasta "Shared"
                    _ViewImports.cshtml
                    _ViewStart.cshtml
                    Error.cshtml
                    Error.cshtml.cs     ------> Arquivos que finalização com ".cs" são classes "PageModel" "C#"
                    Index.cshtml
                    Index.cshtml.cs
                    Privacy.cshtml
                    Privacy.cshtml.cs
            pasta "Properties"
            pasta "wwwroot"
                pasta "css"
                pasta "js"
                pasta "lib"
                    pasta "bootstrap"
                    pasta "jquery"
            appsettings.Development.json  --+
            appsettings.json                |   Root Files
            Program.cs                      |
            RazorPages.csproj             --+

        . A maioria dos recursos desenvolvido pelo "ASP.NET Core MVC", como: tag helpers, view components, etc, podem ser
            reutilizados dentro das páginas "Razor Pages"

        . Roteamento "Razor Pages"

            Route                   Page File
            -----                   ---------
            /                       /Pages/Index.cshtml
            /Contact                /Pages/contact.cshtml
            /Store/Pies             /Pages/Store/Pies.cshtml
            /Store/Pies/3           /Pages/Store/Pies.cshtml
                                    @page "{id:int?}"

    (46.40)
    . DEMO

        . Objetivos:

            . Configurar a aplicação para "Razor Pages"

            . Recriar a página "Checkout" usando "Razor Pages"

        . Acesse o componente "Program.cs" e insira as linhas abaixo:

            using bethanysPieShop.Models;
            using Microsoft.EntityFrameworkCore;

            var builder = WebApplication.CreateBuilder(args);

            builder.Services.AddControllersWithViews();

            builder.Services.AddRazorPages();                       // Linha inserida

            ...


            app.MapDefaultControllerRoute();                        // Linha inserida

            app.MapRazorPages();                                    // Linha inserida

            // app.MapControllerRoute(                              //Linha Alterada - Comente essas linhas
            //     name: "default",
            //    pattern: "{controller=Home}/{action=Index}/{id?}");


            DbInitializer.Seed(app);

            app.Run();

        . Crie a pasta "Pages" na raiz do projeto.

        . Crie a pasta "Pages/Shared" no projeto e insira o arquivo "_PageLayout.cshtml" com o conteúdo abaixo:

            <!DOCTYPE html>

            <html>
            <head>
                <meta name="viewport" content="width=device-width" />
                <title>Bethany's Pie Shop</title>
                <link href='https://fonts.googleapis.com/css?family=Work+Sans' rel='stylesheet' type='text/css'>
                <script src="~/lib/jquery/dist/jquery.js"></script>
                <script src="~/lib/jquery-validate/jquery.validate.js"></script>
                <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
                <script src="~/lib/bootstrap/js/bootstrap.js"></script>
                <link href="~/css/site.css" rel="stylesheet" />
                <base href="/" />
            </head>
            <body>
                <div class="container">
                    <header>
                        <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-primary"
                            aria-label="Bethany's Pie Shop navigation header">
                            <div class="container-xl">
                                <a class="navbar-brand" asp-controller="Home" asp-action="Index">
                                    <img src="images/bethanys-pie-shop-logo_horiz-white.png" width="151" height="47" class="d-inline-block align-top mb-2 mt-1"
                                        alt="Bethany's Pie Shop Logo">
                                </a>

                                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                                        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="navbar-toggler-icon"></span>
                                </button>

                                <div class="collapse navbar-collapse" id="navbarCollapse">
                                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                        <vc:category-menu></vc:category-menu>
                                        <li class="nav-item">
                                            <a asp-controller="Contact" asp-action="Index" class="nav-link">Contact</a>
                                        </li>
                                    </ul>
                                    <vc:shopping-cart-summary></vc:shopping-cart-summary>
                                </div>
                            </div>
                        </nav>
                    </header>

                    @RenderBody()
                </div>
            </body>
            </html>

        . Dentro da pasta "Pages" crie o arquivo "Razor Page" "_ViewStart.cshtml" com o conteúdo abaixo:

            @{
                Layout = "_PageLayout";
            }

        . Dentro da pasta "Pages" crie o arquivo "Razor Page" "_ViewImports.cshmtl" com o conteúdo abaixo:

            @using bethanysPieShop
            @using bethanysPieShop.Models
            @using bethanysPieShop.ViewModels
            @using bethanysPieShop.Components
            @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
            @addTagHelper bethanysPieShop.TagHelpers.*, bethanysPieShop
            @addTagHelper *, bethanysPieShop


        . Dentro da pasta "Pages" crie o arquivo "Razor Page" "CheckoutPage.cshtml" com o conteúdo abaixo:

            @page
            @model bethanysPieShop.Pages.CheckoutPageModel

            <form method="post" class="form-horizontal" role="form">
                <h4>You're just one step away from your delicious pies.</h4>

                <div asp-validation-summary="All" class="text-danger"></div>


                <div class="form-group">
                    <label asp-for="Order.LastName" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.LastName" class="form-control" />
                        <span asp-validation-for="Order.LastName" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Order.FirstName" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.FirstName" class="form-control" />
                        <span asp-validation-for="Order.FirstName" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Order.AddressLine1" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.AddressLine1" class="form-control" />
                        <span asp-validation-for="Order.AddressLine1" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Order.AddressLine2" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.AddressLine2" class="form-control" />
                        <span asp-validation-for="Order.AddressLine2" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Order.ZipCode" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.ZipCode" class="form-control" />
                        <span asp-validation-for="Order.ZipCode" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Order.City" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.City" class="form-control" />
                        <span asp-validation-for="Order.City" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Order.State" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.State" class="form-control" />
                        <span asp-validation-for="Order.State" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Order.Country" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.Country" class="form-control" />
                        <span asp-validation-for="Order.Country" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Order.PhoneNumber" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.PhoneNumber" class="form-control" />
                        <span asp-validation-for="Order.PhoneNumber" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Order.Email" class="col-md-2 control-label"></label>
                    <div class="col-md-5">
                        <input asp-for="Order.Email" class="form-control" />
                        <span asp-validation-for="Order.Email" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-offset-2 col-md-5">
                        <input type="submit" class="btn btn-primary" value="Complete order" />
                    </div>
                </div>

            </form>

        . Crie o componente "PageModel" abaixo com o nome "CheckoutPage.cshtml.cs" com o conteúdo abaixo:

            using bethanysPieShop.Models;
            using Microsoft.AspNetCore.Mvc;
            using Microsoft.AspNetCore.Mvc.RazorPages;

            namespace bethanysPieShop.Pages
            {
                public class CheckoutPageModel : PageModel
                {
                    private readonly IOrderRepository _orderRepository;
                    private readonly IShoppingCart _shoppingCart;

                    public CheckoutPageModel(IOrderRepository orderRepository, IShoppingCart shoppingCart)
                    {
                        _orderRepository = orderRepository;
                        _shoppingCart = shoppingCart;
                    }


                    [BindProperty]
                    public Order Order { get; set; }

                    public void OnGet()
                    {
                    }


                    public IActionResult OnPost()
                    {
                        if (!ModelState.IsValid)
                        {
                            return Page();          // Retorna para a página "CheckoutPageModel.cshmtl"
                        }

                        var items = _shoppingCart.GetShoppingCartItems();
                        _shoppingCart.ShoppingCartItems = items;

                        if (_shoppingCart.ShoppingCartItems.Count == 0)
                        {
                            ModelState.AddModelError("", "Your cart is empty, add some pies first");
                        }

                        if (ModelState.IsValid)
                        {
                            _orderRepository.CreateOrder(Order);
                            _shoppingCart.ClearCart();
                            return RedirectToPage("CheckoutCompletePage");
                        }
                        return Page();
                    }

                }
            }

        . Dentro da pasta "Pages" crie o arquivo "Razor Page" "CheckoutCompletePage.cshtml" com o conteúdo abaixo:

            @page
            @model bethanysPieShop.Pages.CheckoutCompletePageModel



            <h1>@ViewData["CheckoutCompleteMessage"]</h1>


        . Dentro da pasta "Pages" crie o arquivo "Razor Page" "CheckoutCompletePage.cshtml.cs" com o conteúdo abaixo:

            using Microsoft.AspNetCore.Mvc;
            using Microsoft.AspNetCore.Mvc.RazorPages;

            namespace bethanysPieShop.Pages
            {
                public class CheckoutCompletePageModel : PageModel
                {
                    public void OnGet()
                    {
                        ViewData["CheckoutCompleteMessage"] = "Thanks for your order. You'll soon enjoy our delicious pies!";
                    }
                }
            }

        . Coloque um "BreakPoint" na primeira linha do método "OnPost()" da classe "CheckoutPage.cshtml.cs" 

        . Levante o projeto e acesse o link abaixo:

            https://localhost[porta]/checkoutpage

        . Acomnpanhe a execução do código onde foi marcado o "BreakPoint".


Testando os Componentes da Aplicação
====================================

    https://www.toptal.com/qa/how-to-write-testable-code-and-why-it-matters#:~:text=A%20unit%20test%20typically%20features,be%20in%20line%20with%20expectations.

    . A unit test is a method that instantiates a small portion of our application and verifies its behavior independently from other parts.

    . A typical unit test contains 3 phases: 
    
        . First, it initializes a small piece of an application it wants to test (also known as the system under test, or SUT), 
        
        . Then it applies some stimulus to the system under test (usually by calling a method on it), 
        
        . And finally, it observes the resulting behavior. 
        
    . If the observed behavior is consistent with the expectations, the unit test passes, otherwise, it fails, indicating that there is a problem somewhere in the system under test. 
    
    . These three unit test phases are also known as Arrange, Act and Assert, or simply AAA.

    . Usaremos a biblioteca "xUnit"

    . Exemplo simples de uma "Unit Test":

        public void CanUpdatePiePrice()
        {
            // Arrange
            var pe = new Pie { Name = "Sample pie", Price = 12.95M };

            // Act
            pie.Price = 20M;

            // Assert
            Assert.Equal( 20M, pie.Price );
        }

    (6.35)
    . DEMO

        https://www.codemag.com/Article/2009101/Interactive-Unit-Testing-with-.NET-Core-and-VS-Code
        https://xunit.net/docs/getting-started/netcore/cmdline#:~:text=execute%20your%20command.-,Create%20the%20unit%20test%20project,Test%20Project%22%20was%20created%20successfully.
        https://www.learmoreseekmore.com/2022/02/dotnet6-unit-testing-aspnetcore-web-api-using-xunit.html

        . Objetivos:

            . Implementar as correções nos projetos e pacotes

            . Escrever "Unit Tests" para um controller.

        . Instale o "plugin" ".NET Core Test Explorer" no VSCode

        . Crie um projeto com o comando abaixo:

            dotnet new xunit -o bhetanyPieShopTests

        . Apague o arquivo "UnitTest1.cs"

        . Acesse o arquivo "bethhanysPieShopTests.csproj" e acrescente a linha abaixo:

            <Project Sdk="Microsoft.NET.Sdk">

            <PropertyGroup>
                <TargetFramework>net6.0</TargetFramework>
                <Nullable>enable</Nullable>

                <IsPackable>false</IsPackable>
            </PropertyGroup>

            <ItemGroup>
                <PackageReference Include="Microsoft.NET.Test.Sdk" Version="16.11.0" />
                <PackageReference Include="xunit" Version="2.4.1" />
                <PackageReference Include="xunit.runner.visualstudio" Version="2.4.3">
                <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
                <PrivateAssets>all</PrivateAssets>
                </PackageReference>
                <PackageReference Include="coverlet.collector" Version="3.1.0">
                <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
                <PrivateAssets>all</PrivateAssets>
                </PackageReference>
                <PackageReference Include="Moq" Version="4.17.2" />     <!-- linha inserida -->
            </ItemGroup>

            <ItemGroup>
                <ProjectReference Include="..\BethanysPieShop\BethanysPieShop.csproj" />
            </ItemGroup>

            </Project>

        . Crie a dependência desse projeto de testes com o projeto "bethanysPieShop":

            . Na pasta raiz de projetos execute o comando abaixo:

                dotnet add ./bhetanyPieShopTests/ reference ./bhetanyPieShop/

        . Execute o comando abaixo na pasta do projeto "bhetanyPieShopTests":

            dotnet restore

        . Crie a pasta "Mocks" dentro do projeto de testes.

        . Crie a class "RepositoryMocks.cs" dentro da pasta "Mocks" com o conteúdo abaixo:

            using bethanysPieShop.Models;
            using Moq;
            using System;
            using System.Collections.Generic;
            using System.Linq;
            using System.Text;
            using System.Threading.Tasks;

            namespace bethanysPieShopTests.Mocks
            {
                public class RepositoryMocks
                {
                    public static Mock<IPieRepository> GetPieRepository()
                    {
                        var pies = new List<Pie>
                        {
                            new Pie
                            {
                                Name = "Apple Pie",
                                Price = 12.95M,
                                ShortDescription = "Our famous apple pies!",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Fruit pies"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/applepie.jpg",
                                InStock = true,
                                IsPieOfTheWeek = true,
                                ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/applepiesmall.jpg",
                                AllergyInformation = ""
                            },
                            new Pie
                            {
                                Name = "Blueberry Cheese Cake",
                                Price = 18.95M,
                                ShortDescription = "You'll love it!",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Cheese cakes"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/blueberrycheesecake.jpg",
                                InStock = true,
                                IsPieOfTheWeek = false,
                                ImageThumbnailUrl =
                                    "https://gillcleerenpluralsight.blob.core.windows.net/files/blueberrycheesecakesmall.jpg",
                                AllergyInformation = ""
                            },
                            new Pie
                            {
                                Name = "Cheese Cake",
                                Price = 18.95M,
                                ShortDescription = "Plain cheese cake. Plain pleasure.",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Cheese cakes"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/cheesecake.jpg",
                                InStock = true,
                                IsPieOfTheWeek = false,
                                ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/cheesecakesmall.jpg",
                                AllergyInformation = ""
                            },
                            new Pie
                            {
                                Name = "Cherry Pie",
                                Price = 15.95M,
                                ShortDescription = "A summer classic!",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Fruit pies"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/cherrypie.jpg",
                                InStock = true,
                                IsPieOfTheWeek = false,
                                ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/cherrypiesmall.jpg",
                                AllergyInformation = ""
                            },
                            new Pie
                            {
                                Name = "Christmas Apple Pie",
                                Price = 13.95M,
                                ShortDescription = "Happy holidays with this pie!",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Seasonal pies"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/christmasapplepie.jpg",
                                InStock = true,
                                IsPieOfTheWeek = false,
                                ImageThumbnailUrl =
                                    "https://gillcleerenpluralsight.blob.core.windows.net/files/christmasapplepiesmall.jpg",
                                AllergyInformation = ""
                            },
                            new Pie
                            {
                                Name = "Cranberry Pie",
                                Price = 17.95M,
                                ShortDescription = "A Christmas favorite",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Seasonal pies"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/cranberrypie.jpg",
                                InStock = true,
                                IsPieOfTheWeek = false,
                                ImageThumbnailUrl =
                                    "https://gillcleerenpluralsight.blob.core.windows.net/files/cranberrypiesmall.jpg",
                                AllergyInformation = ""
                            },
                            new Pie
                            {
                                Name = "Peach Pie",
                                Price = 15.95M,
                                ShortDescription = "Sweet as peach",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Fruit pies"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/peachpie.jpg",
                                InStock = false,
                                IsPieOfTheWeek = false,
                                ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/peachpiesmall.jpg",
                                AllergyInformation = ""
                            },
                            new Pie
                            {
                                Name = "Pumpkin Pie",
                                Price = 12.95M,
                                ShortDescription = "Our Halloween favorite",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Seasonal pies"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/pumpkinpie.jpg",
                                InStock = true,
                                IsPieOfTheWeek = true,
                                ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/pumpkinpiesmall.jpg",
                                AllergyInformation = ""
                            },
                            new Pie
                            {
                                Name = "Rhubarb Pie",
                                Price = 15.95M,
                                ShortDescription = "My God, so sweet!",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Fruit pies"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/rhubarbpie.jpg",
                                InStock = true,
                                IsPieOfTheWeek = true,
                                ImageThumbnailUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/rhubarbpiesmall.jpg",
                                AllergyInformation = ""
                            },
                            new Pie
                            {
                                Name = "Strawberry Pie",
                                Price = 15.95M,
                                ShortDescription = "Our delicious strawberry pie!",
                                LongDescription =
                                    "Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.",
                                Category = Categories["Fruit pies"],
                                ImageUrl = "https://gillcleerenpluralsight.blob.core.windows.net/files/strawberrypie.jpg",
                                InStock = true,
                                IsPieOfTheWeek = false,
                                ImageThumbnailUrl =
                                    "https://gillcleerenpluralsight.blob.core.windows.net/files/strawberrypiesmall.jpg",
                                AllergyInformation = ""
                            },
                        };

                        var mockPieRepository = new Mock<IPieRepository>();
                        mockPieRepository.Setup(repo => repo.AllPies).Returns(pies);
                        mockPieRepository.Setup(repo => repo.PiesOfTheWeek).Returns(pies.Where(p => p.IsPieOfTheWeek));
                        mockPieRepository.Setup(repo => repo.GetPieById(It.IsAny<int>())).Returns(pies[0]);
                        return mockPieRepository;
                    }

                    public static Mock<ICategoryRepository> GetCategoryRepository()
                    {
                        var categories = new List<Category>
                        {
                            new Category()
                            {
                                CategoryId = 1,
                                CategoryName = "Fruit Pies",
                                Description = "Lorem ipsum"
                            },
                            new Category()
                            {
                                CategoryId = 2,
                                CategoryName = "Cheese cakes",
                                Description = "Lorem ipsum"
                            },
                            new Category()
                            {
                                CategoryId = 3,
                                CategoryName = "Fruit Pies",
                                Description = "Seasonal pies"
                            }
                        };

                        var mockCategoryRepository = new Mock<ICategoryRepository>();
                        mockCategoryRepository.Setup(repo => repo.AllCategories).Returns(categories);

                        return mockCategoryRepository;
                    }

                    private static Dictionary<string, Category>? _categories;
                    public static Dictionary<string, Category> Categories
                    {
                        get
                        {
                            if (_categories == null)
                            {
                                var genresList = new Category[]
                                {
                                    new Category { CategoryName = "Fruit pies" },
                                    new Category { CategoryName = "Cheese cakes" },
                                    new Category { CategoryName = "Seasonal pies" }
                                };

                                _categories = new Dictionary<string, Category>();

                                foreach (var genre in genresList)
                                {
                                    _categories.Add(genre.CategoryName, genre);
                                }
                            }

                            return _categories;
                        }
                    }
                }
            }

        . Crie a pasta "Controllers" dentro do projeto de testes.

        . Crie a class "PieControllerTests.cs" dentro da pasta "Controllers" com o conteúdo abaixo:

            using bethanysPieShop.Controllers;
            using bethanysPieShop.ViewModels;
            using bethanysPieShopTests.Mocks;
            using Microsoft.AspNetCore.Mvc;
            using System;
            using System.Collections.Generic;
            using System.Linq;
            using System.Text;
            using System.Threading.Tasks;
            using Xunit;

            namespace bethanysPieShopTests.Controllers
            {
                public class PieControllerTests
                {
                    [Fact]
                    public void List_EmptyCategory_ReturnsAllPies()
                    {
                        //arrange
                        var mockCategoryRepository = RepositoryMocks.GetCategoryRepository();
                        var mockPieRepository = RepositoryMocks.GetPieRepository();

                        var pieController = new PieController(mockPieRepository.Object, mockCategoryRepository.Object);

                        //act
                        var result = pieController.List("");

                        //assert
                        var viewResult = Assert.IsType<ViewResult>(result);
                        var pieListViewModel = Assert.IsAssignableFrom<PieListViewModel>(viewResult.ViewData.Model);
                        Assert.Equal(10, pieListViewModel.Pies.Count());
                    }
                }
            }


        . Execute os testes, devem resultar em bem sucedidos.

        . Crie a pasta "TagHelpers" e dentro dela cria a classe "EmailTagHelperTests.cs" com o conteúdo abaixo:

            using bethanysPieShop.TagHelpers;
            using Microsoft.AspNetCore.Razor.TagHelpers;
            using Moq;
            using System;
            using System.Collections.Generic;
            using System.Linq;
            using System.Text;
            using System.Threading.Tasks;
            using Xunit;

            namespace bethanysPieShopTests.TagHelpers
            {
                public class EmailTagHelperTests
                {
                    [Fact]
                    public void Generates_Email_Link()
                    {
                        EmailTagHelper emailTagHelper = new EmailTagHelper() { Address = "test@bethanyspieshop.com", Content = "Email" }; ;

                        var tagHelperContext = new TagHelperContext(
                            new TagHelperAttributeList(),
                            new Dictionary<object, object>(), string.Empty);

                        var content = new Mock<TagHelperContent>();

                        var tagHelperOutput = new TagHelperOutput("a",
                            new TagHelperAttributeList(),
                            (cache, encoder) => Task.FromResult(content.Object));

                        // Act
                        emailTagHelper.Process(tagHelperContext, tagHelperOutput);

                        Assert.Equal("Email", tagHelperOutput.Content.GetContent());
                        Assert.Equal("a", tagHelperOutput.TagName);
                        Assert.Equal("mailto:test@bethanyspieshop.com", tagHelperOutput.Attributes[0].Value);
                    }

                }
            }

        . Execute os testes, devem resultar em bem sucedidos.

// PAREI AQUI

Deixando o site interativo
==========================



    . Objetivos deste modulo

        . Utilizando Javascript com ASP.NET Core API

            . Criando um ASP.NET Core API
            . Adicionando JQuery

        . Intrução ao Blazor

    . Utilizando Javascript com ASP.NET Core API

        . Desvantagens do uso raiz do ASP.NET Core MVC ou Razor Page:

            . Atualização da página inteira (resposta) em cada submissão. Recriando header, footer, etc.

            . Excesso de informações na comunicação entre client/server, toda feita através de HTML.

            . Lentidão

        . Refactoring do contexto Razor Page, ou ASP.NET Core MVC.

            . A comunicação será feita através de respostas APIs, utilizando estruturas JSON como respostas e 
                Javascript para renderizar esses dados no client.


    . Criando um ASP.NET Core Restful API

        Rest API Básica
        ---------------

                        Client A    Request HTTP GET
                        (Browser)   <-------------------+
                                    Response JSON       |
                                                        V
                                    Request HTTP POST   Server Rest API                         Database
                        Client B    <------->           ---------------                         --------
                        (Mobile)    Request JSON        Recebe requisições HTTP dos <-------->  Respondem as chamadas API
                                                        clientes e faz requisições              
                                                        ao banco de dados
                                                        ^
                        Client C    Request HTTP PUT    |
                        (Desktop)   <-------------------+
                                    Response JSON

                                    Response:   JSON/XML
                                                Status Code (200, 404, ...)

    . Criando uma API com ASP.NET Core


                                                MVC app
                                    -----------------------------
                    HTTP Request
                    (Header, Params, 
                    Authorization)
            client  <---------------->  Controller
                    HTTP Response           |
                    (Json)                  |
                                            |
                                            |
                                            V       model
                                        Service <---------------+
                                            |                   |
                                            |                   |
                                            |                   |
                                            V                   |
                                        Data Access Layer   ----+
                                            |
                                            |
                                            |
                                            V
                                        Database

    . Configurando o projeto para trabalhar com Restful API:

        . Insira as linhas abaixo na classe "Program.cs":

            ...
            builder.Services.AddControllers();
            ...
            app.MapControllers();
            ...

        . Criar uma classe "Controller" implementando a interface "ControllerBase"

            public class PieController: ControllerBase
            {

            }

        . Configurando as rotas

            // Acessível "/api/pie"
            //
            [Route("api/[controller])]
            public class PieController: ControllerBase
            {

            }
    
        . Configurando os métodos action:

            // Acessível "/api/pie"
            //
            [Route("api/[controller])]
            public class PieController: ControllerBase
            {

                [HttpGet]
                public IActionResult GetAll()
                {

                }
            }

            . Passando parâmetros

                [Route("api/[controller])]
                public class PieController: ControllerBase
                {

                    // Acessível "/api/pie/3"
                    [HttpGet("{id}")]
                    public IActionResult GetById( int id )
                    {

                    }
                }

                // Neste exemplo utilizamos parâmetro simples, porém podemos utilizar tipos complexos (classes)
                // em seu lugar

    . DEMO

        . No projeto "bethanys" na classe "Program.cs" avalie as linhas abaixo:

            builder.Services.AddControllersWithViews()
                .AddJsonOptions(options =>                                                              // Linha inserida
                {                                                                                       // Linha inserida
                    options.JsonSerializerOptions.ReferenceHandler = ReferenceHandler.IgnoreCycles;     // Linha inserida
                });                                                                                     // Linha inserida

            ...
            builder.Services.AddDbContext<AppDbContext>( options => {                           
                options.UseSqlite( 
                    builder.Configuration["ConnectionStrings:DefaultConnection"]);
            });

            // builder.Services.AddControllers();           // Devido o projeto já estar configurado para trabalhar com
                                                            // ASP.NET Core MVC e já configurado com as rotas padrões 
                                                            // das páginas, não é necessários fazer a inserção do "middleware"
                                                            // ".AddControllers"; o "AddControllerWithViews" já é suficiente.
                                                            // Caso não for essa a situação, então acrescente este "middleware"

            app.MapDefaultControllerRoute();                        

            // app.MapControllerRoute(                              //Linha Alterada - Comente essas linhas
            //     name: "default",
            //    pattern: "{controller=Home}/{action=Index}/{id?}");


            // app.MapControllers();                        // Pelo mesmo motivo do projeto já estar configurado para ASP.NET Core MVC
                                                            // não há necessidade de inserir essa linha, pois o "middleware" ".MapDefaultControllerRoute();"
                                                            // já faz essa função. Caso não tivessemos esta configuração teriamos que adicionar o 
                                                            // ".MapControllers()"

            . IMPORTANTE: Para evitar infinitos "loops", foi inserido o método "AddJsonOptions" no middleware "AddControllersWithViews".
                            Isto se deve a situações como o relacionamento entre as classes "Pie" e "Category" que contém coleções umas das
                            outras. Sem isso, o container irá travar num loop infinito.


        . Crie a pasta "Controllers/Api" e dentro dela crie a classe "Controller" abaixo:

            using bethanysPieShop.Models;
            using Microsoft.AspNetCore.Http;
            using Microsoft.AspNetCore.Mvc;

            namespace bethanysPieShop.Controllers.Api
            {
                [Route("api/[controller]")]
                [ApiController]
                public class SearchController : ControllerBase
                {
                    private readonly IPieRepository _pieRepository;

                    public SearchController(IPieRepository pieRepository)
                    {
                        _pieRepository = pieRepository;
                    }


                    [HttpGet]
                    public IActionResult GetAll()
                    {

                    }

                    [HttpGet("{id}")]
                    public IActionResult GetById(int id)
                    {

                    }

                }
            }
        
    . A resposta de uma API

        . Resultados dos métodos ACtion de um "ControllerBase"

            ApiController Method    Description
            --------------------    -----------

            BadRequest() 	        Creates a BadRequestResult object with status code 400.
            Conflict() 	            Creates a ConflictResult object with status code 409.
            Content() 	            Creates a NegotiatedContentResult with the specified status code and data.
            Created() 	            Creates a CreatedNegotiatedContentResult with status code 201 Created.
            CreatedAtRoute() 	    Creates a CreatedAtRouteNegotiatedContentResult with status code 201 created.
            InternalServerError()   Creates an InternalServerErrorResult with status code 500 Internal server error.
            NotFound() 	            Creates a NotFoundResult with status code404.
            Ok() 	                Creates an OkResult with status code 200.
            Redirect() 	            Creates a RedirectResult with status code 302.
            RedirectToRoute() 	    Creates a RedirectToRouteResult with status code 302.
            ResponseMessage() 	    Creates a ResponseMessageResult with the specified HttpResponseMessage.
            StatusCode()         	Creates a StatusCodeResult with the specified http status code.
            Unauthorized() 	        Creates an UnauthorizedResult with status code 401. 
        
        . Retornando um StatusCode "200":

            [Route("api/[controller])]
            public class PieController: ControllerBase
            {

                private readonly IPieRepository _pieRepository;

                [HttpGet]
                public IActionResult GetAll()
                {
                    return Ok( _pieRepository.AllPies );
                }

                [HttpGet("{id}")]
                public IActionResult GetById( int id )
                {
                    if (!_pieRepository.AllPies.Any( p => p.PieId == id ) )
                        return NotFound();

                    ...
                }
            }

    . DEMO

        . Insira a linha abaixo na interface "IPieRepository":

            public interface IPieRepository
            {
                ...
                IEnumerable<Pie> SearchPies( string searchQuery );                          // Linha inserida
            }

        . Substitua o método abaixo na classe "PieRepository":

            ...
             public IEnumerable<Pie> SearchPies( string searchQuery )
             {
                return _bethanysPieShopDbContext.Pies.Where( p => p.Name.Contains( searchQuery ));
             }
             ...

        . Insira as linhas no métodos abaixo na classe "SearchController.cs":

            ...
            [HttpGet]
            public IActionResult GetAll()
            {
                var allPies = _pieRepository.AllPies;                                       // Linha inserida
                return Ok(allPies);                                                         // Linha inserida
            }

            [HttpGet("{id}")]
            public IActionResult GetById(int id)
            {
                if (!_pieRepository.AllPies.Any(p => p.PieId == id))                        // Linha inserida
                    return NotFound();                                                      // Linha inserida
                return Ok(_pieRepository.AllPies.Where(p => p.PieId == id));                // Linha inserida
            }

            [HttpPost]                                                                      // Linha inserida
            public IActionResult SearchPies([FromBody] string searchQuery)                  // Linha inserida
            {
                IEnumerable<Pie> pies = new List<Pie>();                                    // Linha inserida

                if (!string.IsNullOrEmpty(searchQuery))                                     // Linha inserida
                {
                    pies = _pieRepository.SearchPies(searchQuery);                          // Linha inserida
                }                                                                           // Linha inserida
                return new JsonResult(pies);                                                // Linha inserida
            }

            ...

        . Levante a aplicação e execute as URLs abaixo no navegador

            https://localhost:[porta]/api/search            
            https://localhost:[porta]/api/search/2

        . No Postman execute a URL abaixo:

            url:    https://localhost:[porta]/api/search
            method: POST
            body:
                    {
                        JSON: true,
                        raw: "Chocolate"

                    }
    
    (37.08)
    . Adicionando JQuery e Ajax

        . Funções JQuery precisam ser executadas somente após o carregamento da página:

            $(document).ready( function(){
                console.log( "Welcome to Bethany");
            });

        . Executando uma chamada Ajax:

            $.ajax('/ur/to/api',
            {
                dataType: 'json',
                success: function( data ){
                    ...
                },
                error: function( jqXhr, status, error ){
                    ...
                }
            });
    (40.54)
    . DEMO
    
        . Confira se os arquivos ".js" apontados na classe "_Layout.cshtml" estão disponíveis na pasta "wwwroot"
            conforme declarado:

            <!DOCTYPE html>

            <html>
            <head>
                <meta name="viewport" content="width=device-width" />
                <title>Bethany's Pie Shop</title>
                
                <link href='https://fonts.googleapis.com/css?family=Work+Sans' rel='stylesheet' type='text/css'>
                
                <!-- Arquivos necessários para se trabalhar com JQuery -->

                <script src="~/lib/jquery/dist/jquery.js"></script>
                <script src="~/lib/jquery-validate/jquery.validate.js"></script>
                <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
                <script src="~/lib/bootstrap/js/bootstrap.js"></script>
                <link href="~/css/site.css" rel="stylesheet" />
                <base href="/" />
            </head>
            <body>
                ...
            </body>

        . Insira o método abaixo na classe "PieController":

            ...
            public IActionResult Search()
            {
                return View();
            }
            ...

        (42.58)        
        . Crie a classe "Search.cshtml" com conteúdo abaixo na pasta "Views/Pie":


            <br />
            <br />
            <br />
            <br />
            Enter your search query:
            <input id="txtPieName" type="text" />
            <button id="searchButton">Search</button>
            <br />
            <br />
            <table id="tblPies" cellpadding="0" cellspacing="0">
                <tr>
                    <th style="width: 120px"></th>
                    <th style="width: 120px">Name</th>
                    <th style="width: 90px">Price</th>
                </tr>
                <tbody></tbody>
            </table>


            <script type="text/javascript">

                $(document).ready(function(){
                $("button").click(function(){
                    var searchQuery = $.trim($("#txtPieName").val());
                        $("table tbody").html("");
                        $.ajax({
                            type: "POST",
                            url: "/api/search",
                            data: "\"" + searchQuery + "\"",
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (pies) {
                                var table = $("#tblPies");
                                table.find("tr:not(:first)").remove();
                                $.each(pies, function (i, pie) {
                                    $("tbody").append($("<tr>"));
                                    appendElement = $("tbody tr").last();
                                    appendElement.append($("<td>").html('<img src=' + pie.imageThumbnailUrl + '>'));
                                    appendElement.append($("<td>").html('<a href="/pie/details/' + pie.pieId + '">' + pie.name + '</a>'));
                                    appendElement.append($("<td>").html(pie.price));
                                });
                            },
                            error: function (xhr, status, error) {
                                    console.log(xhr)
                            }
                        });
                    });
                    });

            </script>

        . Insira as linhas abaixo no componente "Views/Shared/_Layout.cshtml":

            ...
            <body>
                <div class="container">
                    <header>
                        <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-primary"
                            aria-label="Bethany's Pie Shop navigation header">
                            <div class="container-xl">
                                <a class="navbar-brand" asp-controller="Home" asp-action="Index">
                                    <img src="images/bethanys-pie-shop-logo_horiz-white.png" width="151" height="47" class="d-inline-block align-top mb-2 mt-1"
                                        alt="Bethany's Pie Shop Logo">
                                </a>

                                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                                        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="navbar-toggler-icon"></span>
                                </button>

                                <div class="collapse navbar-collapse" id="navbarCollapse">
                                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                        <vc:category-menu></vc:category-menu>
                                        <li class="nav-item">
                                            <a asp-controller="Contact" asp-action="Index" class="nav-link">Contact</a>
                                        </li>
                                    </ul>

                                    <!-- Trecho inserido -->

                                    <ul class="navbar-nav mb-2 mb-lg-0">
                                        <li class="nav-item">
                                            <a class="nav-link" asp-controller="Pie" asp-action="Search">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                                                </svg>
                                            </a>
                                        </li>
                                    </ul>

                                    <!-- Fim do trecho -->

                                    <vc:shopping-cart-summary></vc:shopping-cart-summary>
                                </div>
                            </div>
                        </nav>
                    </header>

                    @RenderBody()
                </div>
            </body>

        . Levante a aplicação e teste o icone de lupa no canto superior direito.

    (46.36)
    . Introdução ao ASP.NET Core Blazor

        . Blzaor é um framework para construir páginas HTML utilizando C# e HTML, fazendo parte do ASP.NET COre.

        51.50

Configurando Autenticação e Autorização
=======================================

    https://code-maze.com/asp-net-core-identity-series/
    https://medium.com/c-sharp-progarmming/tutorial-asp-net-core-with-identity-299d0fe4cba1
    https://www.learnentityframeworkcore.com/walkthroughs/existing-database
    https://www.learnrazorpages.com/miscellaneous/scaffolding
    https://mapadevelopment.com/community/tutorials/generate-views-and-controller-in-dotnet-core-with-codegenerator

    https://education.launchcode.org/csharp-web-development/chapters/auth/scaffolding.html
    https://www.learmoreseekmore.com/2022/01/dotnet6-implementing-aspnetcore-identity-authentication-in-to-an-existing-blazor-server-app.html
    https://bjdejongblog.nl/asp-net-core-tips-and-quick-setup-identity-system/
    https://gavilan.blog/2019/07/18/accountcontroller-missing-razor-class-libraries-dotnet-cli-identity-scaffolding/


    # dotnet ef dbcontext scaffold "Server=.\SQLEXPRESS;Database=SchoolDB;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -o Models
    # dotnet ef dbcontext scaffold "Datasource=C:\ASPNET\APIApp\webbookmarks.db3" -o Models Microsoft.EntityFrameworkCore.Sqlite -c "APIAppDbContext" -f -a
    # Scaffold-DbContext "DataSource=PATH\mydatabase.sqlite3 "Microsoft.EntityFrameworkCore.Sqlite -OutputDir Models

    . Objetivos:

        . Entender o funcionamento do ASP.NET Core Identity

        . Adicionar autenticação ao site

        . Usar a autorização.

    . Entender o funcionamento do ASP.NET Core Identity

        . ASP.NET Core Identity é um membro do framework ASP.NET Core.

        . Suporte a interface gráfica de funcionalidade de login.

        . Controle de autenticação e autorização.

        . Suport externo a providers de autenticação, como: Google, facebook, etc.

        . Administra usuário, pápeis, claims, senhas, confirmação por email, etc.

        . Suporte a "scaffolding"

    . Para adicionar suporte ao ASP.NET Core Identity precisamos adicionar o serviço abaixo ao projeto no "program.cs":

                                                +---------> Representa a classe "User"
                                                |
        builder.Services.AddDefaultIdentity<IdentituUser>()
            .AddEntityFrameworkStores<BethanysPieShopDbContext>();
                                                |
                                                +---------> DbContext

        . Opções para configuração para o ASP.NET Core Identity:

            builder.Services.AddDefaultIdentity<IdentituUser>( options =>
            {
                options.Password.RequireDigit = true;
                options.Password.RequireLength = 8;
                options.Password.RequireNonAlphanumeric = true;
                options.User.RequireUniqueEmail = true;
                
            })
            .AddEntityFrameworkStores<BethanysPieShopDbContext>();

    . DEMO

        . Execute o comando abaixo na pasta raiz do projeto:

            dotnet add package Microsoft.AspNetCore.Identity.EntityFrameworkCore --version 6.0.13

            dotnet add package Microsoft.AspNetCore.Identity.UI --version 6.0.13

        . Acesse a classe "DbContext.cs" e altere a linha abaixo:

            ...
            public class DbContext: IdentityDbContext                    // DbContext       // Linha aterada, substitução da interfae "DbContext" pela "IdentityDbContext"
            ...

        . Acesse a classe "Program.cs" e faça a atualização abaixo:

            ...
            app.UseStaticFile();
            app.UseSession();
            app.UseAuthentication();                                    // Linha inserida
            ...

        . Na raiz do projeto execute os comandos abaixo:

            dotnet clean

            dotnet build

            dotnet ef migrations add IdentityMigration

            dotnet ef database update

        . Acesse o banco de dados e verifique se as tabelas do ASP.NET Core Identity foram criadas com sucesso.

(13.00)

        


https://education.launchcode.org/csharp-web-development/chapters/auth/scaffolding.html
https://www.learnentityframeworkcore.com/walkthroughs/existing-database
https://gavilan.blog/2019/07/18/accountcontroller-missing-razor-class-libraries-dotnet-cli-identity-scaffolding/


dotnet new mvc -o sampleIdentity -n sampleIdentity -f net6.0

dotnet add package Microsoft.EntityFrameworkCore.Design --version 6.0.13
dotnet add package Microsoft.AspNetCore.Identity.UI --version 6.0.13
dotnet add package Microsoft.AspNetCore.Identity.EntityFrameworkCore --version 6.0.13
dotnet add package Microsoft.EntityFrameworkCore.Sqlite --version 6.0.12
dotnet add package Microsoft.EntityFrameworkCore.Tools --version 6.0.12
dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design --version 6.0.11
dotnet tool install --global dotnet-aspnet-codegenerator --version 6.0.11

Criação do DbContext (1936)
Criação do Model (2114)

